<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.4.0 -->
    <script>window.materialVersion = "1.4.0"</script>

    <!-- Title -->
    
    <title>
        
            Django实现用户短信注册 | 
        
        ayuLiao
    </title>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    
    
    
    
    

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="ayuLiao">
    <meta name="description" itemprop="description" content="">
    <meta name="keywords" content=",python">

    <!-- Site Verification -->
    
    

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="ayuLiao">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://lmwen.top">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Django实现用户短信注册 | ayuLiao">
    <meta property="og:image" content="/img/favicon.png" />
    <meta property="og:description" content="">
    <meta property="og:article:tag" content="python"> 

    
        <meta property="article:published_time" content="Sat Nov 18 2017 11:32:26 GMT+0800" />
        <meta property="article:modified_time" content="Sat Nov 18 2017 11:38:27 GMT+0800" />
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="Django实现用户短信注册 | ayuLiao">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="/img/favicon.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="http://lmwen.top" />

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://lmwen.top/2017/11/18/Django实现用户短信注册/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "ayuLiao",
        "logo": "/img/favicon.png"
    },
    "author": {
        "@type": "Person",
        "name": "ayuLiao",
        "image": {
            "@type": "ImageObject",
            "url": "/img/favicon.png"
        },
        "description": "过往不恋，未来不惧，当下不乱"
    },
    "headline": "Django实现用户短信注册",
    "url": "http://lmwen.top/2017/11/18/Django实现用户短信注册/index.html",
    "datePublished": "Sat Nov 18 2017 11:32:26 GMT+0800",
    "dateModified": "Sat Nov 18 2017 11:38:27 GMT+0800",
    "description": "",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://lmwen.top"
    }
}
</script>


    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+materialVersion+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(data&&data.indexOf(versionString)===-1){lsloader.removeLS(key)}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload){cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload);return}code=code.split(versionString)[1];if(/\.js?.+$/.test(versionNumber)){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload)}};lsloader.requestResource=function(name,path,cssonload){var that=this;if(/\.js?.+$/.test(path)){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else if(/\.css?.+$/.test(path)){this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import CSS & jQuery -->
    
        <style id="css/material.min.css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("css/material.min.css","/css/material.min.css?fJTiM/K1J3dWIruo3pxtAw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";})</script>
        <style id="css/style.min.css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("css/style.min.css","/css/style.min.css?oCSEO3ST+aEypEwttTDI9g==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";})</script>
        
        
            <style>
    
    
    
    .footer-sns-gplus {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNiA3OGMtMjIuNCA1LjItNTUuOCA0MC4yLTYwLjYgNjMuNC0xLjQgNi40LTIgMTI5LjgtMS42IDM2Ny42LjYgMjk4LjYgMSAzNTguOCAzLjQgMzYzIDExIDIwLjIgMjEuNiAzMi40IDM3LjIgNDMgMTUgMTAuMiAxNy40IDExLjIgMzMgMTMgMTEuMiAxLjQgMTM2IDIgMzY1IDEuNiAzMTQtLjYgMzQ4LjYtMSAzNTUtMy44IDE1LjgtNy4yIDMzLjgtMjIgNDMuMi0zNS40IDUuMi03LjQgMTAuOC0xNi42IDEyLjYtMjAuNCAyLjgtNi40IDMuMi00MC44IDMuOC0zNTQgLjQtMjIzLS4yLTM1My40LTEuNC0zNjUtMi0xNy0yLjYtMTguNi0xMy0zNC04LjYtMTIuNi0xNC4yLTE4LjQtMjUuMi0yNS44LTcuOC01LjQtMTcuNC0xMS0yMS42LTEyLjQtNi0yLjItNzIuOC0yLjYtMzY1LjQtMi42LTE5Ni44LjItMzYxIC44LTM2NC40IDEuOHpNNDMwIDI5NS40YzQwLjYgMTUuNCA1Ni42IDIzLjggNzIuNiAzOC40IDYuOCA2LjIgNy4yIDE1LjIgMSAyMy40LTYuMiA4LTMzLjYgMzMuOC0zOSAzNi42LTUuNiAyLjgtMTcuNiAyLjgtMjMuMi0uMi0yLjQtMS4yLTguMi01LjItMTMtOC44LTExLjItOC42LTI0LjYtMTEuMi01NS4yLTExLjItMjcuNCAwLTQwLjYgMi42LTUyLjIgMTAuNC00LjQgMi44LTEyLjIgNy42LTE3LjIgMTAuNi0yMyAxMy4yLTUxLjQgNTUtNTUuOCA4Mi40LTIuNiAxNS42LTIuNCAzNC44LjIgNTEgMi44IDE3LjQgMTkuOCA0OC44IDM1LjIgNjUuMiAxNiAxNi42IDQ1IDMzLjYgNjIuOCAzNi42IDI2LjggNC40IDY1LjggMS42IDc5LjQtNS44IDIwLjYtMTEuNCAzMS0xOSA0MS0zMC40IDE4LjgtMjEuNiAyMy40LTM0LjIgMTUuNi00My44LTMuOC00LjgtNC40LTQuOC01MS01LjgtNjAuOC0xLjItNTYuMiAyLjItNTYuMi00My4yIDAtMzIuNC4yLTMzLjIgNC44LTM3IDQuNC0zLjYgOS0zLjggOTItMy44IDc5IDAgODcuOC40IDk0LjIgMy42IDExLjIgNS42IDEzIDExLjQgMTIuOCA0My40IDAgMjUuNC0uOCAzMC44LTcuNiA1OC00IDE2LjYtOS44IDM0LTEyLjYgMzktMi44IDUtOC4yIDE0LjItMTEuNiAyMC42LTguNCAxNS40LTI3LjIgMzYuOC00MC44IDQ2LjYtNS44IDQuNC0xMy44IDEwLjItMTcuNiAxMy4yLTMuOCAzLTExIDctMTYuMiA4LjgtNS4yIDEuOC0xNi4yIDYuNC0yNC40IDEwLTIyLjQgOS42LTM0LjggMTEuNi03MyAxMS42LTM3LjYuMi00Ny0xLjQtNzEtMTItOC4yLTMuNi0xNy42LTcuMi0yMC44LTgtMTUuOC0zLjgtNjctNDUuMi03Ny44LTYyLjgtMi4yLTMuOC03LjYtMTEuNi0xMS44LTE3LjItNC4yLTUuNC05LTE0LTEwLjYtMTktMS44LTQuOC02LjItMTYtMTAtMjQuOC0zLjYtOC44LTcuOC0yMi4yLTkuMi0yOS42LTMuMi0xOC44LTEuNC03OS40IDIuOC05MS40IDEzLjgtNDAuNiAzNS42LTc4IDU4LjgtMTAwLjIgMTQtMTMuNiA0Ny4yLTM2LjQgNTgtMzkuOCA0LjItMS40IDEzLjQtNS4yIDIwLjYtOC40IDIyLTEwIDMyLjgtMTEuNiA3Ni0xMSAzMy44LjYgNDAuNCAxLjIgNTAgNC44em0zNDAuOCA4MC44YzggMy42IDkuNiAxMS4yIDkuMiAzOS4yLS42IDM0LjQtLjYgMzQgNSAzOS42IDQuOCA1IDUuNCA1IDM3LjYgNSA0My40IDAgNDQuNC44IDQzLjIgMzYuMi0uOCAxNy0xLjIgMTguNC02LjQgMjMtNS40IDQuNi02LjYgNC44LTM3LjYgNC44LTMxLjIgMC0zMiAuMi0zNi44IDUtNS42IDUuNC01LjYgNC40LTUgNDEuMi40IDI2LjQuMiAyNy40LTQuNiAzMy00LjggNS42LTYgNS44LTI0LjQgNi40LTIwLjguOC0yOS42LTEuNC0zMy40LTguNC0xLjQtMi42LTItMTUuNi0xLjgtMzUuNi40LTMxLjIuNC0zMS42LTQuNi0zNi42cy01LjYtNS0zNi01Yy0xOC44IDAtMzMtLjgtMzYtMi4yLTcuNi0zLjYtOS42LTExLjItOC44LTMzLjguOC0yOC4yLjQtMjggNDEtMjggNDUuNCAwIDQ1LjQgMCA0NC42LTQyLjYtLjYtMzMtLjYtMzMgNS0zOC40IDQuNC00LjYgNi4yLTUgMjQuOC01IDExIDAgMjIuMiAxIDI1IDIuMnoiLz48L3N2Zz4=);
    }
    
    
    
    
    
    .footer-sns-github {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNCA3OGMtNi40IDEuNC0yNi40IDE0LjItMzYgMjIuOC04IDcuMi0yMiAyOS44LTI0LjQgMzkuMi0xLjYgNi40LTIgMTEzLjItMS42IDM2OCAuNiAyOTkuNCAxIDM1OS44IDMuNCAzNjQgMTEgMjAuMiAyMS42IDMyLjQgMzcuMiA0MyAxNS42IDEwLjYgMTcuMiAxMS4yIDM0LjIgMTMuMiAxMC42IDEuMiA2My40IDEuNiAxMjcuNiAxLjRsMTA5LjYtLjYgNi02LjggNi4yLTYuOC0xLjItMjUuMmMtLjgtMTUuOC0uMi0zMy40IDEuNC00Ny4yIDMtMjUuNCAxLjQtMzYuMi02LTQzLjItNS00LjYtNi4yLTQuOC0zMC42LTQuMi0yNy42LjgtMjQgMS42LTY4LjgtMTYtOC42LTMuNC0yMi42LTE4LTI4LjQtMjkuOC0xMS40LTIyLjgtMjctNDUtMzkuMi01NS42LTE0LTEyLjItMTkuOC0yMC44LTE5LjgtMjguNiAwLTExLjYgMTMuNi0xMi42IDMzLjItMi40IDE2LjYgOC44IDIwLjggMTIuNCA0MC44IDM2LjIgMjQuMiAyOC42IDMxIDMzLjYgNTQgMzkuNiAxNS4yIDQgNDIuMiAzIDUxLjQtMS44IDktNC42IDE4LTE1LjIgMjQuNC0yOS4yIDExLjQtMjQuMiA3LjQtMzEuMi0yMC42LTM2LjgtOS44LTItMjkuMi04LTQzLjQtMTMuNC00MC40LTE1LjgtNjQuNi0zNy40LTg1LjQtNzYuMi0xMS42LTIxLjgtMTUuNC0zMy0xOC4yLTUzLjYtNC4yLTMyLjItNC44LTYwLjItMS40LTg0IDMuNC0yMy44IDYuOC0zMi44IDIwLjItNTQgNC02IDguOC0xNS42IDExLTIxLjQgMy44LTEwIDMuOC0xMS42IDEtMzAtNS4yLTM0LjItMy4yLTUyLjQgNy42LTcwLjIgNy4yLTEyLjIgMTUtMTcuMiAyNC4yLTE1LjggMTIuOCAyLjIgNTIgMTcuNCA2Ni44IDI2LjIgMjYgMTUgMjkgMTUuNCA4Mi40IDcuMiAyNC42LTMuOCAzMy44LTQuMiA2MC0zLjIgMTcgLjYgNDEuNCAzIDU0IDUuMiAzOC40IDYuNiA0OS42IDUuMiA3My0xMCA2LjYtNC4yIDE3LjQtOS40IDI0LTExLjYgNi42LTIuMiAxNi01LjggMjEtOC4yIDEzLTYgMjgtNS42IDM1LjYuOCAxMi40IDEwLjQgMTguNiA0MS40IDE0LjQgNzEuNi00LjQgMzAuNi0zIDM5LjQgOC40IDUzLjggMy40IDQuNCAxMS4yIDE5LjIgMTcuNCAzMy4yTDc3NSA0NDN2NzhsLTEwIDI4Yy0xNS4yIDQzLjItMzYuOCA3My4yLTY2LjIgOTIuOC0xMy40IDguOC01NyAyNS40LTc2LjggMjktMjguMiA1LjItMzMuMiAxMi42LTIyIDMyLjIgMTEuMiAxOS40IDEyLjQgMzIuOCAxMS42IDEyOS42bC0uNiA4NS44IDUuNCA0LjZjMy42IDMgOS4yIDUuMiAxNiA2IDUuOC44IDYwLjIgMSAxMjAuNi42IDEwOC40LS42IDExMC4yLS42IDExOS01IDI0LTExLjYgNDAtMjcuNCA1MS42LTUwLjZsNS40LTExIC42LTM0N2MuNC0yMjMtLjItMzUzLjQtMS40LTM2NS0yLTE3LTIuNi0xOC42LTEzLTM0LTEwLjYtMTUuNC0yMi44LTI2LjItNDMuMi0zNy4yLTQuMi0yLjQtNjQuNi0yLjgtMzY2LTMuMi0xOTguNiAwLTM2NCAuNC0zNjcuNiAxLjR6Ii8+PC9zdmc+);
    }
    
    
    
    
    
</style>

        
        <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"rel="stylesheet">


        <script>lsloader.load("js/jquery.min.js","/js/jquery.min.js?ezyEvm8ST5CGfpA+kFFi1g==")</script>
    
    
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Analytics -->
    

    <!-- Custom Head -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    
    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#简介"><span class="post-toc-number">1.</span> <span class="post-toc-text">简介</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#图片验证码的逻辑"><span class="post-toc-number">2.</span> <span class="post-toc-text">图片验证码的逻辑</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#短信验证码的逻辑"><span class="post-toc-number">3.</span> <span class="post-toc-text">短信验证码的逻辑</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#用户短信注册逻辑"><span class="post-toc-number">4.</span> <span class="post-toc-text">用户短信注册逻辑</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#项目环境"><span class="post-toc-number">5.</span> <span class="post-toc-text">项目环境</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#搭建项目和创建数据库"><span class="post-toc-number">6.</span> <span class="post-toc-text">搭建项目和创建数据库</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#图片验证码"><span class="post-toc-number">7.</span> <span class="post-toc-text">图片验证码</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#短信验证码"><span class="post-toc-number">8.</span> <span class="post-toc-text">短信验证码</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#用户注册"><span class="post-toc-number">9.</span> <span class="post-toc-text">用户注册</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#自定义登录"><span class="post-toc-number">10.</span> <span class="post-toc-text">自定义登录</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#结尾"><span class="post-toc-number">11.</span> <span class="post-toc-text">结尾</span></a></li></ol>
        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>
    





<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        <!-- Custom Thumbnail -->
        <div class="post_thumbnail-custom mdl-card__media mdl-color-text--grey-50" style="background-image:url(http://obfs4iize.bkt.clouddn.com/Django%E7%94%A8%E6%88%B7%E7%9F%AD%E4%BF%A1%E6%B3%A8%E5%86%8C.jpg)">
    
            <p class="article-headline-p">
                Django实现用户短信注册
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>ayuLiao</strong>
        <span>11月 18, 2017</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/python/">python</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Django实现用户短信注册&url=http://lmwen.top/2017/11/18/Django实现用户短信注册/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Django实现用户短信注册&url=http://lmwen.top/2017/11/18/Django实现用户短信注册/index.html&via=ayuLiao" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://lmwen.top/2017/11/18/Django实现用户短信注册/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://lmwen.top/2017/11/18/Django实现用户短信注册/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    
        <a class="post_share-link" href="https://www.linkedin.com/shareArticle?mini=true&url=http://lmwen.top/2017/11/18/Django实现用户短信注册/index.html&title=Django实现用户短信注册" target="_blank">
            <li class="mdl-menu__item">
                分享到 LinkedIn
            </li>
        </a>
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>网站常见的注册方式有两种，一种是邮箱注册，一种是短信注册，其实两者的实现思路没有太大的差异，就是具体的实现方式有点不同，为了防止简单的爬虫，在注册时要加上图片验证码，当然这也只是增加爬取的难度，并不是杜绝，爬虫的事情其实也可以写一篇文章来聊聊。</p>
<p>本篇文章讲解Django后端实现短信注册的逻辑和代码，不关心前端实现，以前后端分离的形式进行开发，前端可以用Django本身的模板语言，或者其他前端框架</p>
<h2 id="图片验证码的逻辑"><a href="#图片验证码的逻辑" class="headerlink" title="图片验证码的逻辑"></a>图片验证码的逻辑</h2><p>在实现完整的短信注册的功能前，先要理清图片验证码的流程，前面也简单提了，使用图片验证码的目的是为了防止简单爬虫和恶意用户使用脚本暴力注册，降低服务器的压力。</p>
<p>所谓图片验证码其实就是让用户输入图片中的内容，将用户在前端输入的内容返回给后端做验证，那么具体是什么逻辑呢？</p>
<p>首先我们得在后台生成图片、图片的答案和图片的唯一ID，将图片答案和图片的唯一ID存到数据库中，将生成的图片和图片的唯一ID发送给前端，让前端进行显示，那么当用户填写图片验证码时，就可以将用户填写的答案和唯一的ID传回给后端，后端通过唯一的ID在数据库中找答案，如果找出的答案和用户填写的内容一致，图片验证码就通过，如果不一致，就返回错误信息，为了让系统更可靠，还可以加上过期时间，也就是每个图片验证码都有个有效时间，如果过了这个有效时间了，该图片验证码就失效了，不能再用于验证了</p>
<h2 id="短信验证码的逻辑"><a href="#短信验证码的逻辑" class="headerlink" title="短信验证码的逻辑"></a>短信验证码的逻辑</h2><p>短信验证码的逻辑其实比图片验证码更加简单，找一个发短信的商户，这里我使用云片网提供的短信服务，使用起来比较方便，首先在云片网上注册一个账号，然后填写一下个人信息和公司信息，接着去申请短信模板，模板申请成功后就可以接入短信服务了，使用云片网的短信服务需要注意的就是<strong>申请的短信模板和编写代码时要发送的短信内容必须一致</strong>，不然短信发送就无法成功，差一个标点符号都不会成功</p>
<p>我申请的模板<br><img src="http://onxxjmg4z.bkt.clouddn.com/yunpian.jpg" alt="yunpian"></p>
<p>申请好短信模板后，就可以来理一理代码逻辑，首先要验证前端传递过来的值，这些值必须有用户的手机号、图片验证码答案和图片验证码的ID，获得这些值后，还需要进行验证，首先通过正则表达式验证手机号，如果你是去网上找的，要注意这个正则表达式的日期，太旧的正则表达式会让很多新的合法手机号验证失败，自己去正则表达式验证网站多验证几个手机号，看看这个正则表达式是否合理，如果手机号是合法的，就验证图片验证码，判断图片验证码的答案是否正确，图片验证码有无过期</p>
<p>上面的验证都通过后，就可以调用第三方商户给我提供的短信服务了</p>
<h2 id="用户短信注册逻辑"><a href="#用户短信注册逻辑" class="headerlink" title="用户短信注册逻辑"></a>用户短信注册逻辑</h2><p>前面两个都明白了，这个就非常简单了，简单将就是验证用户的短信验证码是否正确，同时再验证一下手机号，图片验证码，还有就是要判断短信验证码和图片验证码是否过期，如果所有条件都通过，就将用户的数据存到数据表中</p>
<h2 id="项目环境"><a href="#项目环境" class="headerlink" title="项目环境"></a>项目环境</h2><p>短信注册的项目算是每个中大型web系统中都会有的东东，前后端交互性还是挺强的，也是很重要的一部分，项目的开发环境：Python3.5+Django(1.11.6)+Django REST Framework(3.7.1)</p>
<p>Django REST Framework是Django中用于开发Restful api的利器，也是Django前后端分离开发常用的库，它对Django的方法进行了二次分装，提供更多方法给我开发合适的Restful api，并且有强大的文档功能，可以直接根据代码来生产接口文档给前端看，这样就不必我们手动维护一个文档了，对于Django REST Framework基础的用法，本篇文章就不讲了，各位可以先去<a href="http://www.django-rest-framework.org/" target="_blank" rel="external">官网</a>上看看</p>
<p>Django和Django rest framework都可以直接通过pip安装，至于项目中要使用的其他库，自行pip安装</p>
<h2 id="搭建项目和创建数据库"><a href="#搭建项目和创建数据库" class="headerlink" title="搭建项目和创建数据库"></a>搭建项目和创建数据库</h2><p>如何搭建Django项目就不多说了，这里我们创建users模块，后面短信注册的代码都写到这个模块中，先来看一下整个项目的结构</p>
<p><img src="" alt="短信注册项目结构"></p>
<p>我们创建了media文件夹，在该文件夹下创建了codeimage文件夹，用于存放验证码图片。创建了static文件夹，存放静态文件，这里存放了simsum这个字体文件，该字体文件用于生成验证码图片中的内容</p>
<p>接着来创建该项目要使用的数据表，这里我们要创建3张表，分别是用于存用户信息的用户表UserProfile，用于存图片验证码数据的表ImageCode，还有就是用于存短信验证码的表VerifyCode</p>
<p>将这三张表的代码写在 users/models.py中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</div><div class="line"></div><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</div><div class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> AbstractUser</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfile</span><span class="params">(AbstractUser)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">    用户模块，继承Django默认的User，添加新字段</span></div><div class="line"><span class="string">    """</span></div><div class="line">    <span class="comment"># null=True 数据库可空 blank=True HTML可空</span></div><div class="line">    name = models.CharField(max_length=<span class="number">30</span>, null=<span class="keyword">True</span>, blank=<span class="keyword">True</span>, verbose_name=<span class="string">"姓名"</span>)</div><div class="line">    gender = models.CharField(max_length=<span class="number">6</span>, choices=((<span class="string">"male"</span>, <span class="string">u"男"</span>), (<span class="string">"female"</span>, <span class="string">"女"</span>)), default=<span class="string">"female"</span>,verbose_name=<span class="string">"性别"</span>)</div><div class="line">    birthday = models.DateField(null=<span class="keyword">True</span>, blank=<span class="keyword">True</span>, verbose_name=<span class="string">'出生年月'</span>)</div><div class="line">    <span class="comment"># 手机号可以为空，本项目将username作为手机号来使用</span></div><div class="line">    mobile = models.CharField(null=<span class="keyword">True</span>, blank=<span class="keyword">True</span>, max_length=<span class="number">11</span>, verbose_name=<span class="string">"电话"</span>)</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        verbose_name = <span class="string">"用户"</span></div><div class="line">        verbose_name_plural = verbose_name</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.username</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageCode</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="string">'''</span></div><div class="line"><span class="string">    图片验证码，防止短信狂注册</span></div><div class="line"><span class="string">    将随机生成的短信验证码图片和验证码ID返回前端，前端返回用户填写的结果和codeid</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    codeid = models.CharField(max_length=<span class="number">40</span>, verbose_name=<span class="string">'验证码ID'</span>)</div><div class="line">    code = models.CharField(max_length=<span class="number">10</span>, verbose_name=<span class="string">'验证码'</span>)</div><div class="line">    add_time = models.DateTimeField(default=datetime.now, verbose_name=<span class="string">"添加时间"</span>)</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        verbose_name = <span class="string">"图片验证码"</span></div><div class="line">        verbose_name_plural = verbose_name</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.code</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">VerifyCode</span><span class="params">(models.Model)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line"><span class="string">    短信验证码</span></div><div class="line"><span class="string">    """</span></div><div class="line">    code = models.CharField(max_length=<span class="number">10</span>, verbose_name=<span class="string">"验证码"</span>)</div><div class="line">    mobile = models.CharField(max_length=<span class="number">11</span>, verbose_name=<span class="string">"电话"</span>)</div><div class="line">    add_time = models.DateTimeField(default=datetime.now, verbose_name=<span class="string">"添加时间"</span>)</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        verbose_name = <span class="string">"短信验证码"</span></div><div class="line">        verbose_name_plural = verbose_name</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.code</div></pre></td></tr></table></figure>
<p>Django建表就不用多说了，代码中都有简单的注释，这里简单提几点，UserProfile用户表继承自Django自带的用户表，也就是AbstractUser，那么我们的UserProfile就会获得AbstarctUser中的字段，如Username，password，email这些字段，还有就是图片验证码表和短信验证码表中的add_time字段用于存时间，主要用于判断验证码是否过期，这里要注意的就是我们使用的datetime.now，而不是datetime.now()</p>
<p>这样本项目中要使用的数据表就设计好了，接着就去settings.py配置数据库连接，这里使用最常见的mysql</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">DATABASES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;</div><div class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</div><div class="line">        <span class="string">'NAME'</span>: <span class="string">'数据库名'</span>,</div><div class="line">        <span class="string">'USER'</span>:<span class="string">'数据库用户名'</span>,</div><div class="line">        <span class="string">'PASSWORD'</span>:<span class="string">'数据库密码'</span>,</div><div class="line">        <span class="string">'HOST'</span>:<span class="string">'127.0.0.1'</span>,</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里顺便将项目中的其他配置一起配了</p>
<p>先配置一下Django的语言环境，将英文配置成中文</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">LANGUAGE_CODE = &apos;zh-hans&apos;</div><div class="line"></div><div class="line">TIME_ZONE = &apos;Asia/Shanghai&apos;</div><div class="line"></div><div class="line">USE_I18N = True</div><div class="line"></div><div class="line">USE_L10N = True</div><div class="line"># 默认是Ture，时间是utc时间，由于我们要用本地时间，所用手动修改为false</div><div class="line">USE_TZ = False</div></pre></td></tr></table></figure>
<p>因为是前后端分离的方式，前端请求我们后端就会存在跨域问题，要解决这个问题也非常简单，首先通过pip安装一下corsheader</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install django-cors-headers</div></pre></td></tr></table></figure>
<p>接着价格corsheader注册到INSTALLED_APPS中，当然前面创建的users也要注册到其中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">    &apos;django.contrib.admin&apos;,</div><div class="line">    &apos;django.contrib.auth&apos;,</div><div class="line">    &apos;django.contrib.contenttypes&apos;,</div><div class="line">    &apos;django.contrib.sessions&apos;,</div><div class="line">    &apos;django.contrib.messages&apos;,</div><div class="line">    &apos;django.contrib.staticfiles&apos;,</div><div class="line">    &apos;users&apos;,</div><div class="line">    # 实现跨越请求</div><div class="line">    &apos;corsheaders&apos;</div><div class="line">]</div></pre></td></tr></table></figure>
<p>然后就要配置一下允许与后端进行数据交互的IP，只有这个IP发起的方法才允许跨域，这里让所有IP都可以与后端进行数据交互，非常粗暴</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">#跨域增加忽略</div><div class="line">CORS_ALLOW_CREDENTIALS = True</div><div class="line">CORS_ORIGIN_WHITELIST = (</div><div class="line">    &apos;*&apos;</div><div class="line">)</div><div class="line"></div><div class="line">CORS_ALLOW_METHODS = (</div><div class="line">    &apos;DELETE&apos;,</div><div class="line">    &apos;GET&apos;,</div><div class="line">    &apos;OPTIONS&apos;,</div><div class="line">    &apos;PATCH&apos;,</div><div class="line">    &apos;POST&apos;,</div><div class="line">    &apos;PUT&apos;,</div><div class="line">    &apos;VIEW&apos;,</div><div class="line">)</div><div class="line"></div><div class="line">CORS_ALLOW_HEADERS = (</div><div class="line">    &apos;XMLHttpRequest&apos;,</div><div class="line">    &apos;X_FILENAME&apos;,</div><div class="line">    &apos;accept-encoding&apos;,</div><div class="line">    &apos;authorization&apos;,</div><div class="line">    &apos;content-type&apos;,</div><div class="line">    &apos;dnt&apos;,</div><div class="line">    &apos;origin&apos;,</div><div class="line">    &apos;user-agent&apos;,</div><div class="line">    &apos;x-csrftoken&apos;,</div><div class="line">    &apos;x-requested-with&apos;,</div><div class="line">    &apos;Pragma&apos;,</div><div class="line">)</div></pre></td></tr></table></figure>
<p>最后还需要设置一下拦截器，拦截器的位置要注意，因为拦截器处理数据请求时是有顺序的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">MIDDLEWARE = [</div><div class="line">    <span class="string">'django.middleware.security.SecurityMiddleware'</span>,</div><div class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</div><div class="line">    <span class="comment"># 跨域请求</span></div><div class="line">    <span class="string">'corsheaders.middleware.CorsMiddleware'</span>,</div><div class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</div><div class="line">    <span class="string">'django.middleware.csrf.CsrfViewMiddleware'</span>,</div><div class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</div><div class="line">    <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</div><div class="line">    <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</div><div class="line">]</div></pre></td></tr></table></figure>
<p>这样跨域问题就解决了</p>
<p>然后将静态文件的路径和资源文件路径配置一下，也就是static和media的路径，只有配置了Django才能路由到这两个文件夹中的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">STATIC_URL = &apos;/static/&apos;</div><div class="line"></div><div class="line">STATIC_URL = &apos;/static/&apos;</div><div class="line"></div><div class="line">MEDIA_URL = &apos;/media/&apos;</div><div class="line"></div><div class="line">STATICFILES_DIRS = (</div><div class="line">    os.path.join(BASE_DIR, &apos;static&apos;),</div><div class="line">)</div><div class="line">MEDIA_ROOT = os.path.join(BASE_DIR, &apos;media&apos;)</div></pre></td></tr></table></figure>
<p>因为我们是使用短信来注册，验证用户的手机号，那么后期肯定是通过手机号来登录，而Django默认只能通过Username字段来登录，所以我们要自定义一下登录规则，这里先配置一下，后面再写具体的登录逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 使用自定义的登录规则</div><div class="line">AUTHENTICATION_BACKENDS = (</div><div class="line">    &apos;users.views.CustomBackend&apos;,</div><div class="line">)</div></pre></td></tr></table></figure>
<p>因为我们的UserProfile继承了Django默认的用户表，所以要在这里配置一下，告诉Django不要使用默认的用户表了，而是使用我们自己创建的用户表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 使用自定义的用户</div><div class="line">AUTH_USER_MODEL = &apos;users.UserProfile&apos;</div></pre></td></tr></table></figure>
<p>最后将一些常量也放到这里，一个是手机号的正则表达式，一个是云片网的API Key，发送短信时要带上这个API Key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">#手机号码正则表达式</div><div class="line">REGEX_MOBILE = &quot;^1[358]\d&#123;9&#125;$|^147\d&#123;8&#125;$|^176\d&#123;8&#125;$&quot;</div><div class="line"></div><div class="line">#云片网设置</div><div class="line">APIKEY = &quot;云片网API Key&quot;</div></pre></td></tr></table></figure>
<p>这样配置就配完了，整个项目的骨架也就有了</p>
<p>配置完后，就<strong>使用makemigrations和migrate命令将数据库同步一下，在开发项目时，数据表的每个变动都要通过这两个命令，让变动真正在MySQL数据库中生效</strong></p>
<h2 id="图片验证码"><a href="#图片验证码" class="headerlink" title="图片验证码"></a>图片验证码</h2><p>搭建完项目骨架后，就先从最简单的功能写起，先写图片验证码，创建一个名为makeimage的py文件，我们使用Python著名的图片处理库PIL来创建图片验证码所需要的验证码图片，先定义一个图片类，该类用于生成验证码图片，代码比较简短，而且有详细的注释，就不在细讲</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont, ImageFilter</div><div class="line"><span class="keyword">import</span> random,time,string</div><div class="line"></div><div class="line"><span class="keyword">from</span> SMSReg.settings <span class="keyword">import</span> STATICFILES_DIRS,MEDIA_ROOT</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Picture</span><span class="params">(object)</span>:</span></div><div class="line">    <span class="string">'''</span></div><div class="line"><span class="string">    图片类，用于图片验证码</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, text_str, size, background)</span>:</span></div><div class="line">        <span class="string">'''</span></div><div class="line"><span class="string">        text_str: 验证码显示的字符组成的字符串</span></div><div class="line"><span class="string">        size:  图片大小</span></div><div class="line"><span class="string">        background: 背景颜色</span></div><div class="line"><span class="string">        '''</span></div><div class="line">        self.text_list = list(text_str)</div><div class="line">        self.size = size</div><div class="line">        self.background = background</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_pic</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="string">'''</span></div><div class="line"><span class="string">        创建一张图片</span></div><div class="line"><span class="string">        '''</span></div><div class="line">        self.width, self.height = self.size</div><div class="line">        self.img = Image.new(<span class="string">"RGB"</span>, self.size, self.background)</div><div class="line">        <span class="comment"># 实例化画笔</span></div><div class="line">        self.draw = ImageDraw.Draw(self.img)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_point</span><span class="params">(self, num, color)</span>:</span></div><div class="line">        <span class="string">'''</span></div><div class="line"><span class="string">        num: 画点的数量</span></div><div class="line"><span class="string">        color: 点的颜色</span></div><div class="line"><span class="string">        功能：画点</span></div><div class="line"><span class="string">        '''</span></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(num):</div><div class="line">            self.draw.point(</div><div class="line">                (random.randint(<span class="number">0</span>, self.width), random.randint(<span class="number">0</span>, self.height)),</div><div class="line">                fill=color</div><div class="line">            )</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_line</span><span class="params">(self, num, color)</span>:</span></div><div class="line">        <span class="string">'''</span></div><div class="line"><span class="string">        num: 线条的数量</span></div><div class="line"><span class="string">        color: 线条的颜色</span></div><div class="line"><span class="string">        功能：画线条</span></div><div class="line"><span class="string">        '''</span></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(num):</div><div class="line">            self.draw.line(</div><div class="line">                [</div><div class="line">                    (random.randint(<span class="number">0</span>, self.width), random.randint(<span class="number">0</span>, self.height)),</div><div class="line">                    (random.randint(<span class="number">0</span>, self.width), random.randint(<span class="number">0</span>, self.height))</div><div class="line">                ],</div><div class="line">                fill=color</div><div class="line">            )</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_text</span><span class="params">(self, font_type, font_size, font_color, font_num, start_xy)</span>:</span></div><div class="line">        <span class="string">'''</span></div><div class="line"><span class="string">        font_type: 字体</span></div><div class="line"><span class="string">        font_size: 文字大小</span></div><div class="line"><span class="string">        font_color: 文字颜色</span></div><div class="line"><span class="string">        font_num:  文字数量</span></div><div class="line"><span class="string">        start_xy:  第一个字左上角坐标,元组类型，如 (5,5)</span></div><div class="line"><span class="string">        功能： 画文字</span></div><div class="line"><span class="string">        '''</span></div><div class="line">        font = ImageFont.truetype(font_type, font_size)</div><div class="line">        ran_text = <span class="string">" "</span>.join(random.sample(self.text_list, font_num))</div><div class="line">        self.draw.text(start_xy, ran_text, font=font, fill=font_color)</div><div class="line">        <span class="keyword">return</span> ran_text</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">opera</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="string">'''</span></div><div class="line"><span class="string">        功能：给画出来的线条，文字，扭曲一下，缩放一下，位移一下，滤镜一下。</span></div><div class="line"><span class="string">        就是让它看起来有点歪，有点扭。</span></div><div class="line"><span class="string">        '''</span></div><div class="line">        params = [</div><div class="line">            <span class="number">1</span> - float(random.randint(<span class="number">1</span>, <span class="number">2</span>)) / <span class="number">100</span>,</div><div class="line">            <span class="number">0</span>,</div><div class="line">            <span class="number">0</span>,</div><div class="line">            <span class="number">0</span>,</div><div class="line">            <span class="number">1</span> - float(random.randint(<span class="number">1</span>, <span class="number">10</span>)) / <span class="number">100</span>,</div><div class="line">            float(random.randint(<span class="number">1</span>, <span class="number">2</span>)) / <span class="number">500</span>,</div><div class="line">            <span class="number">0.001</span>,</div><div class="line">            float(random.randint(<span class="number">1</span>, <span class="number">2</span>)) / <span class="number">500</span></div><div class="line">        ]</div><div class="line">        self.img = self.img.transform(self.size, Image.PERSPECTIVE, params)</div><div class="line">        self.img = self.img.filter(ImageFilter.EDGE_ENHANCE_MORE)</div></pre></td></tr></table></figure>
<p>创建好这个类后，就来使用它，先生成带有噪音的背景，然后通过随机抽取的4个字符生成图片验证码的内容，接着扭曲、缩放一下字符内容，这样就可以得到一张简单的验证码，最后将答案和验证唯一ID返回，这个ID其实也是图片的名称，代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">def GetImageCode():</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    获得图片验证码</div><div class="line">    :return: right_text:正确答案  code_id:验证码唯一ID</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    strings = &quot;abcdefghjkmnpqrstwxyz23456789ABCDEFGHJKLMNPQRSTWXYZ&quot;</div><div class="line">    size = (150, 50)</div><div class="line">    background = &apos;white&apos;</div><div class="line">    pic = Picture(strings, size, background)</div><div class="line">    pic.create_pic()</div><div class="line">    pic.create_point(500, (220, 220, 220))</div><div class="line">    pic.create_line(30, (220, 220, 220))</div><div class="line">    # 加载simsun.ttc字体文件，用于生产图片中的内容</div><div class="line">    right_text = pic.create_text(STATICFILES_DIRS[0] + &quot;/simsun.ttc&quot;, 24, (0, 0, 205), 4, (7, 7))</div><div class="line">    pic.opera()</div><div class="line">    # pic.img.show()</div><div class="line">    # 随机字符串：随机字符+时间戳</div><div class="line">    ran_str = &apos;&apos;.join(random.sample(string.ascii_letters + string.digits, 16)) + str(int(time.time()))</div><div class="line">    pic.img.save(MEDIA_ROOT + &apos;/codeimage/&apos; + ran_str + &apos;.png&apos;)</div><div class="line">    return &#123;&apos;right_text&apos;:right_text,&apos;code_id&apos;:ran_str&#125;</div><div class="line"></div><div class="line"></div><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line"> # 自己可以简单测试一下</div><div class="line">    GetImageCode()</div></pre></td></tr></table></figure>
<p>获得验证码图片的方法写完了，接着就来写相应的接口，将代码写到 users/views.py中，因为要获得图片验证码不需要什么参数字段，所以直接通过GET方法获得就好了，使用刚刚在makgeimage.py中定义的GetImageCode()方法，每当一个GET请求过来时就调用这个方法，将正确的答案和ID保存到数据库，将图片的路径和ID返回给前端，具体代码如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImageCodeView</span><span class="params">(APIView)</span>:</span></div><div class="line">    <span class="string">'''</span></div><div class="line"><span class="string">    获得图片验证码</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, request, *args, **kwargs)</span>:</span></div><div class="line">        codedict = GetImageCode()</div><div class="line">        codeid = codedict.get(<span class="string">'code_id'</span>,<span class="number">0</span>)</div><div class="line">        reight_text = codedict.get(<span class="string">'right_text'</span>,<span class="number">0</span>)</div><div class="line">        reight_text = reight_text.replace(<span class="string">' '</span>,<span class="string">''</span>)</div><div class="line">        imagemodel = ImageCode(codeid=codeid, code= reight_text)</div><div class="line">        imagemodel.save()</div><div class="line">        re_dict = &#123;<span class="string">'imagepath'</span>:<span class="string">'/media/codeimage/'</span>+codeid+<span class="string">'.png'</span>,<span class="string">'codeid'</span>:codeid&#125;</div><div class="line">        <span class="keyword">return</span> Response(re_dict, status=status.HTTP_201_CREATED)</div></pre></td></tr></table></figure>
<p>接着配置一下url，写到urls.py中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">from django.conf.urls import url,include</div><div class="line">from django.views.static import serve</div><div class="line"></div><div class="line"># 图片验证码</div><div class="line">    url(r&apos;^imagecode&apos;, ImageCodeView.as_view(), name=&apos;imagename&apos;),</div><div class="line">    # 访问图片URL</div><div class="line">    url(r&apos;^media/(?P&lt;path&gt;.*)$&apos;, serve, &#123;&apos;document_root&apos;: MEDIA_ROOT&#125;),</div></pre></td></tr></table></figure>
<p>这里处理配置imagecode这个接口的url外，还需要<strong>配置访问生成的验证码图片的接口，如果不配置这个接口，图片验证码的图片就无法通过URL来访问</strong></p>
<p>这样就可以获得图片验证码了，我们可以通过postman来访问一下这个接口</p>
<p><img src="http://onxxjmg4z.bkt.clouddn.com/%E8%8E%B7%E5%BE%97%E5%9B%BE%E7%89%87%E9%AA%8C%E8%AF%81%E7%A0%81.jpg" alt=""></p>
<p>将图片的路径复制下来，放到浏览器上，看看图片的效果</p>
<p><img src="http://onxxjmg4z.bkt.clouddn.com/%E5%9B%BE%E7%89%87%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE.jpg" alt=""></p>
<p>通过Navicat查看一下图片数据表</p>
<p><img src="http://onxxjmg4z.bkt.clouddn.com/%E5%9B%BE%E7%89%87%E6%95%B0%E6%8D%AE%E5%BA%93.jpg" alt=""></p>
<h2 id="短信验证码"><a href="#短信验证码" class="headerlink" title="短信验证码"></a>短信验证码</h2><p>有了图片验证码，就可以来实现短信验证码了，因为每次发短信都要验证图片验证码是否正确，同样将逻辑写到 users/views.py 中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line">lass SmsCodeViewset(mixins.CreateModelMixin, viewsets.GenericViewSet):</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    发送短信验证码</div><div class="line">    &quot;&quot;&quot;</div><div class="line">    serializer_class = SmsSerializer</div><div class="line"></div><div class="line">    def generate_code(self):</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        生成四位数字的验证码</div><div class="line">        :return:</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        seeds = &quot;1234567890&quot;</div><div class="line">        random_str = []</div><div class="line">        for i in range(4):</div><div class="line">            random_str.append(choice(seeds))</div><div class="line">        return &quot;&quot;.join(random_str)</div><div class="line"></div><div class="line">    def codecheck(self,code, codeid):</div><div class="line">        &apos;&apos;&apos;</div><div class="line">        验证图片验证码，防止恶意用户狂注册</div><div class="line">        :param code: 用户填写的验证码</div><div class="line">        :param codeid: 验证码ID</div><div class="line">        :return:</div><div class="line">        &apos;&apos;&apos;</div><div class="line">        five_mintes_ago = datetime.now() - timedelta(hours=0, minutes=5, seconds=0)</div><div class="line">        right_code = ImageCode.objects.filter(codeid=codeid)</div><div class="line">        # lte 小于等于 gte 大于等于</div><div class="line">        tright_code = right_code.exclude(add_time__gte=five_mintes_ago)</div><div class="line">        if not tright_code:</div><div class="line">            return 2</div><div class="line">        if right_code:</div><div class="line">            if str(right_code[0]).lower() != str(code).lower():</div><div class="line">                return 0</div><div class="line">        else:</div><div class="line">            return 0</div><div class="line"></div><div class="line">        return 1</div><div class="line"></div><div class="line"></div><div class="line">    def create(self, request, *args, **kwargs):</div><div class="line">        serializer = self.get_serializer(data=request.data)</div><div class="line">        # 序列化和验证</div><div class="line">        serializer.is_valid(raise_exception=True)</div><div class="line">        mobile = serializer.validated_data[&apos;mobile&apos;]</div><div class="line">        data = request.data</div><div class="line">        imagecode = request.data.get(&apos;code&apos;,0)</div><div class="line">        imagecodeid = request.data.get(&apos;codeid&apos;,0)</div><div class="line"></div><div class="line">        image_c = self.codecheck(code=imagecode, codeid=imagecodeid)</div><div class="line"></div><div class="line">        if image_c ==2:</div><div class="line">            return Response(data=&#123;&apos;error&apos;:&apos;图片验证码超时&apos;&#125;, status=status.HTTP_400_BAD_REQUEST)</div><div class="line">        elif image_c == 0:</div><div class="line">            return Response(data=&#123;&apos;error&apos;: &apos;图片验证码错误&apos;&#125;, status=status.HTTP_400_BAD_REQUEST)</div><div class="line">        yun_pian = YunPian(APIKEY)</div><div class="line"></div><div class="line">        code = self.generate_code()</div><div class="line"></div><div class="line">        sms_status = yun_pian.send_sms(code=code, mobile=mobile)</div><div class="line"></div><div class="line">        if sms_status[&quot;code&quot;] != 0:</div><div class="line">            return Response(&#123;</div><div class="line">                &quot;data&quot;:&apos;error&apos;</div><div class="line">            &#125;, status=status.HTTP_400_BAD_REQUEST)</div><div class="line">        else:</div><div class="line">            code_record = VerifyCode(code=code, mobile=mobile)</div><div class="line">            code_record.save()</div><div class="line">            return Response(&#123;</div><div class="line">                &quot;data&quot;:&apos;success&apos;</div><div class="line">            &#125;, status=status.HTTP_201_CREATED)</div></pre></td></tr></table></figure>
<p>这里使用了SmsSerializer类对前端传递的值进行序列化和验证，使用generate_code()方法随机生成用于短信发送的4位数验证码，使用chodecheck()方法检查前端传递过来的图片验证码，除了验证用户输入的是否正确，还加了验证码5分钟过期的时间限制，这里有几个细节要注意，<strong>1.验证码验证的时间要比当前时间减去5分钟大。2.用户输入的验证码在对比时通过lower转换成小写，实现不区分大小写</strong></p>
<p>接着看到我们重写的create()方法，该方法会被Django自动调用，在该方法中，我们使用get_serializer()方法将要序列化和验证的值传入，代码中将前端传递的所有值都传入，然后通过is_valid()方法判断序列化是否通过，通过了才会继续下面的逻辑，也就是将通过序列化的手机号提取出来，使用自己封装好的方法将手机号和要发送的验证码发送出去</p>
<p>这里先来看一下SmsSerializer中的代码，看看序列化到底干了啥？</p>
<p>在users下创建名为serializer的py文件，该文件专门用于写序列化代码，看到SmsSerializer类的代码，其实就是对手机号进行验证判断是否合法，是否已经注册过了，发送短信的频率是否过快</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">import re</div><div class="line">from datetime import datetime, timedelta</div><div class="line"></div><div class="line">from rest_framework import serializers</div><div class="line">from django.contrib.auth import get_user_model</div><div class="line">from rest_framework.validators import UniqueValidator</div><div class="line"></div><div class="line">from SMSReg.settings import REGEX_MOBILE</div><div class="line">from .models import VerifyCode,ImageCode</div><div class="line"></div><div class="line"># 可直接获得用户</div><div class="line">User = get_user_model()</div><div class="line"></div><div class="line"># 继承最基本的Serializer</div><div class="line">class SmsSerializer(serializers.Serializer):</div><div class="line"></div><div class="line">    mobile = serializers.CharField(max_length=11)</div><div class="line"></div><div class="line">    def validate_mobile(self, mobile):</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        验证手机号码</div><div class="line">        :param data:</div><div class="line">        :return:</div><div class="line">        &quot;&quot;&quot;</div><div class="line">        # 手机是否注册</div><div class="line">        if User.objects.filter(mobile=mobile).count():</div><div class="line">            raise serializers.ValidationError(&quot;用户已经存在&quot;)</div><div class="line"></div><div class="line">        # 验证手机号码是否合法</div><div class="line">        if not re.match(REGEX_MOBILE, mobile):</div><div class="line">            raise serializers.ValidationError(&quot;手机号码非法&quot;)</div><div class="line"></div><div class="line">        # 验证码发送频率</div><div class="line">        one_mintes_ago = datetime.now() - timedelta(hours=0, minutes=1, seconds=0)</div><div class="line">        if VerifyCode.objects.filter(add_time__gt=one_mintes_ago, mobile=mobile).count():</div><div class="line">            raise serializers.ValidationError(&quot;距离上一次发送未超过60s&quot;)</div><div class="line"></div><div class="line">        return mobile</div></pre></td></tr></table></figure>
<p>接着来看通过云片网发送短信的代码，非常简单</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">YunPian</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, api_key)</span>:</span></div><div class="line">        self.api_key = api_key</div><div class="line">        self.single_send_url = <span class="string">"https://sms.yunpian.com/v2/sms/single_send.json"</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_sms</span><span class="params">(self, code, mobile)</span>:</span></div><div class="line">        parmas = &#123;</div><div class="line">            <span class="string">"apikey"</span>: self.api_key,</div><div class="line">            <span class="string">"mobile"</span>: mobile,</div><div class="line">            <span class="string">"text"</span>: <span class="string">"【微宽量化】您的验证码是&#123;code&#125;（5分钟内有效，如非本人操作，请忽略本短信）"</span>.format(code=code)</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        response = requests.post(self.single_send_url, data=parmas)</div><div class="line">        re_dict = json.loads(response.text)</div><div class="line">        <span class="keyword">return</span> re_dict</div></pre></td></tr></table></figure>
<p>这里需要获得你云片网的API Key，大家注册一下就有了，然后就是使用固定的格式来发送信息，<strong>前面也强调了，这里的text，必须跟云片网上申请的短信模板一模一样，不然短信回发送失败</strong>，通过requests对云片网提供的URL进行POST请求，就将短信发送了，可以将云片网返回的数据保存到字典中，用于判断短信是否发送成功</p>
<p>这样短信发送和图片验证码验证的逻辑就写完了，老规矩，配置一下URL就好了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">from rest_framework.routers import DefaultRouter</div><div class="line"></div><div class="line">from SMSReg.settings import MEDIA_ROOT</div><div class="line">from users.views import UserViewset,SmsCodeViewset,ImageCodeView</div><div class="line"></div><div class="line">router = DefaultRouter()</div><div class="line"></div><div class="line"># 短信验证码接口</div><div class="line">router.register(r&apos;codes&apos;, SmsCodeViewset, base_name=&quot;codes&quot;)</div></pre></td></tr></table></figure>
<p>同样通过postman来测试一下这个接口</p>
<p>先通过上一个接口获得的图片验证码，填写正确的答案和验证码ID，再将手机号传入，通过POST方法访问短信验证码接口</p>
<p><img src="http://onxxjmg4z.bkt.clouddn.com/%E5%8F%91%E9%80%81%E7%9F%AD%E4%BF%A1.jpg" alt=""></p>
<p>可以看到发送短信成功，打开手机查看一下，果真有条短信</p>
<p><img src="http://onxxjmg4z.bkt.clouddn.com/%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%A0%812.jpeg" alt=""></p>
<p>查看一下数据库中的短信表，发现有一条与之对应的数据</p>
<p><img src="http://onxxjmg4z.bkt.clouddn.com/%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%A0%81.jpg" alt=""></p>
<h2 id="用户注册"><a href="#用户注册" class="headerlink" title="用户注册"></a>用户注册</h2><p>做完了图片验证码和短信验证码，相当于做完了前期工作，接着才是用户注册的逻辑，用户注册要查表判断用户填写的短信是否正确，同样在 users/views.py 中写逻辑</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserViewset</span><span class="params">(mixins.CreateModelMixin, mixins.UpdateModelMixin, mixins.RetrieveModelMixin,</span></span></div><div class="line"><span class="class"><span class="params">                  viewsets.GenericViewSet)</span>:</span></div><div class="line">    <span class="string">'''</span></div><div class="line"><span class="string">    用户</span></div><div class="line"><span class="string">    '''</span></div><div class="line">    serializer_class =  UserRegSerializer</div><div class="line">    queryset = User.objects.all()</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self, request, *args, **kwargs)</span>:</span></div><div class="line">        <span class="comment"># 将post过来的数据传给UserRegSerializer进行序列化和验证</span></div><div class="line">        serializer = self.get_serializer(data=request.data)</div><div class="line">        serializer.is_valid(raise_exception=<span class="keyword">True</span>)</div><div class="line">        user = self.perform_create(serializer)</div><div class="line">        re_dict = serializer.data</div><div class="line">        re_dict[<span class="string">"name"</span>] = user.name <span class="keyword">if</span> user.name <span class="keyword">else</span> user.username</div><div class="line">        re_dict[<span class="string">"success"</span>] = <span class="string">'注册成功'</span></div><div class="line"></div><div class="line">        headers = self.get_success_headers(serializer.data)</div><div class="line">        <span class="keyword">return</span> Response(re_dict, status=status.HTTP_201_CREATED, headers=headers)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_object</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.request.user</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perform_create</span><span class="params">(self, serializer)</span>:</span></div><div class="line">        <span class="keyword">return</span> serializer.save()</div></pre></td></tr></table></figure>
<p>看上去代码量似乎比前面的少，这也就Django Rest Framework的优势，它已经为我们提供了很多常用的操作，如minins中已经实现好了相关的增删改查操作，让UserViewset用户类的代码变得非常少，但是却依旧有很多功能，这些代码没什么特别的，就是通过UserRegSerializer对前端数据传递过来的数据进行序列化和验证，验证通过，则使用perform_create()方法调用serializer.save()将数据保存一下</p>
<p>重点是UserRegSerializer中发生了什么？</p>
<p>接着看到serializer.py中的UserRegSerializer类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserRegSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></div><div class="line">    <span class="comment"># 这里使用了write_only是因为后面我们将code字段通过del方法删除了，所以在序列化时，不使用write_only字段会报错，</span></div><div class="line">    code = serializers.CharField(required=<span class="keyword">True</span>, write_only=<span class="keyword">True</span>, max_length=<span class="number">4</span>, min_length=<span class="number">4</span>, label=<span class="string">"验证码"</span>,</div><div class="line">                                 error_messages=&#123;</div><div class="line">                                     <span class="string">"blank"</span>: <span class="string">"请输入验证码"</span>,</div><div class="line">                                     <span class="string">"required"</span>: <span class="string">"请输入验证码"</span>,</div><div class="line">                                     <span class="string">"max_length"</span>: <span class="string">"验证码格式错误"</span>,</div><div class="line">                                     <span class="string">"min_length"</span>: <span class="string">"验证码格式错误"</span></div><div class="line">                                 &#125;, help_text=<span class="string">"验证码"</span>)</div><div class="line">    <span class="comment"># 图片验证码</span></div><div class="line">    imagecode = serializers.CharField(required=<span class="keyword">True</span>, write_only=<span class="keyword">True</span>, max_length=<span class="number">4</span>, min_length=<span class="number">4</span>, label=<span class="string">"图片验证码"</span>,</div><div class="line">                                      error_messages=&#123;</div><div class="line">                                          <span class="string">"blank"</span>: <span class="string">"请输入图片验证码"</span>,</div><div class="line">                                          <span class="string">"required"</span>: <span class="string">"请输入图片验证码"</span>,</div><div class="line">                                          <span class="string">"max_length"</span>: <span class="string">"图片验证码格式错误"</span>,</div><div class="line">                                          <span class="string">"min_length"</span>: <span class="string">"图片验证码格式错误"</span></div><div class="line">                                      &#125;, help_text=<span class="string">"图片验证码"</span>)</div><div class="line">    imagecodeid = serializers.CharField(required=<span class="keyword">True</span>, write_only=<span class="keyword">True</span>, label=<span class="string">'图片验证码ID'</span>)</div><div class="line"></div><div class="line">    <span class="comment"># UniqueValidator:验证数据集中数据的唯一性，用户不能重复注册</span></div><div class="line">    username = serializers.CharField(label=<span class="string">'手机号'</span>, required=<span class="keyword">True</span>, allow_blank=<span class="keyword">False</span>,</div><div class="line">                                     validators=[UniqueValidator(queryset=User.objects.all(), message=<span class="string">'用户已存在'</span>)])</div><div class="line"></div><div class="line">    password = serializers.CharField(style=&#123;<span class="string">'input_type'</span>:<span class="string">'password'</span>&#125;, label=<span class="string">'密码'</span>, write_only=<span class="keyword">True</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(self, validated_data)</span>:</span></div><div class="line">        <span class="comment"># 继承</span></div><div class="line">        user = super(UserRegSerializer, self).create(validated_data=validated_data)</div><div class="line">        <span class="comment"># 加密密码</span></div><div class="line">        user.set_password(validated_data[<span class="string">'password'</span>])</div><div class="line">        user.save()</div><div class="line">        <span class="keyword">return</span> user</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_imagecode</span><span class="params">(self,imagecode)</span>:</span></div><div class="line">        <span class="comment"># initial_data是没有经过serializers处理过的数据,post中需要传入imagecodeid</span></div><div class="line">        image_code = ImageCode.objects.filter(codeid=self.initial_data[<span class="string">'imagecodeid'</span>])</div><div class="line">        five_mintes_ago = datetime.now() - timedelta(hours=<span class="number">0</span>, minutes=<span class="number">5</span>, seconds=<span class="number">0</span>)</div><div class="line">        timage_code = image_code.exclude(add_time__gte=five_mintes_ago)</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> timage_code:</div><div class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">"图片验证码超时"</span>)</div><div class="line">        <span class="keyword">if</span> image_code:</div><div class="line">            k = str(image_code[<span class="number">0</span>])</div><div class="line">            k2 = str(image_code[<span class="number">0</span>]).lower()</div><div class="line">            <span class="keyword">if</span> str(image_code[<span class="number">0</span>]).lower() != imagecode.lower():</div><div class="line">                <span class="keyword">raise</span> serializers.ValidationError(<span class="string">"图片验证码错误"</span>)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">"图片验证码错误"</span>)</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate_code</span><span class="params">(self, code)</span>:</span></div><div class="line">        <span class="comment"># post中需要传入username</span></div><div class="line">        verify_records = VerifyCode.objects.filter(mobile=self.initial_data[<span class="string">"username"</span>]).order_by(<span class="string">"-add_time"</span>)</div><div class="line">        <span class="keyword">if</span> verify_records:</div><div class="line">            last_record = verify_records[<span class="number">0</span>]</div><div class="line">            <span class="comment"># 5分钟有效期</span></div><div class="line">            five_mintes_ago = datetime.now() - timedelta(hours=<span class="number">0</span>, minutes=<span class="number">5</span>, seconds=<span class="number">0</span>)</div><div class="line">            <span class="keyword">if</span> five_mintes_ago &gt; last_record.add_time:</div><div class="line">                <span class="keyword">raise</span> serializers.ValidationError(<span class="string">"验证码过期"</span>)</div><div class="line">            <span class="keyword">if</span> last_record.code != code:</div><div class="line">                <span class="keyword">raise</span> serializers.ValidationError(<span class="string">"验证码错误"</span>)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">raise</span> serializers.ValidationError(<span class="string">"验证码错误"</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self, attrs)</span>:</span></div><div class="line">        <span class="string">'''</span></div><div class="line"><span class="string">        对序列化的字段统一操作，删除不需要的验证存库的字段</span></div><div class="line"><span class="string">        '''</span></div><div class="line">        attrs[<span class="string">'mobile'</span>] = attrs[<span class="string">'username'</span>]</div><div class="line">        <span class="keyword">del</span> attrs[<span class="string">'code'</span>]</div><div class="line">        <span class="keyword">del</span> attrs[<span class="string">'imagecode'</span>]</div><div class="line">        <span class="keyword">del</span> attrs[<span class="string">'imagecodeid'</span>]</div><div class="line">        <span class="keyword">return</span> attrs</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></div><div class="line">        model = User</div><div class="line">        fields = (<span class="string">"username"</span>, <span class="string">"code"</span>, <span class="string">"mobile"</span>, <span class="string">"password"</span>, <span class="string">'imagecode'</span>, <span class="string">'imagecodeid'</span>,<span class="string">'name'</span>)</div></pre></td></tr></table></figure>
<p>这里有几点值得注意<br>1.code、imagecode、imagecodeid、password都使用write_only字段，该字段标识只写，也就是不能读，将其设置为True以确保在更新或创建实例时可以使用该字段，但在序列化表示时不包括该字段,默认为False</p>
<p>2.username字段中对validators使用了UniqueValidator，DjangoRestFramework中还有多个可以这样使用的函数，这里UniqueValidator函数的作用就是让前端传递过来的username在User.objects.all()查询的结果集中唯一，目的就是保证这个用户不是重复注册</p>
<p>3.password字段设置了style，将style设置成{‘input_type’:’password’}可以让用户使用前端界面输入时是密文的形式，这里的前端界面是DjangoRestFramework自带用于测试接口的前端</p>
<p>4.重写了create()方法，在该方法中，我们继承了默认create()方法，然后使用了set_password()方法将密码密文保存</p>
<p>5.validate_imagecode()和validate<em>code()方法都是validate</em>字段名的格式，这样形式的方法会针对某个字段，如validate_imagecode就针对imagecode字段生效，validate_code针对code字段生效，这两个方法中的逻辑跟前面图片验证码和短信验证码的逻辑类似</p>
<p>6.validate()方法对所有字段生效，在这个方法中，我们将username中的值赋值给mobile，前端可以不传递mobile，但是必须传递username，然后将code、imagecode、imagecodeid删除，因为UserProfile表中没有这几个字段，如果不删除在使用serializer.save()保存时就会报错</p>
<p>最后配置一下url</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 用户接口</div><div class="line">router.register(r&apos;users&apos;, UserViewset, base_name=&quot;users&quot;)</div></pre></td></tr></table></figure>
<p>同样通过postman来测试一个注册接口，将短信和图片验证码都正确的填上</p>
<p>可以看到注册成功，返回了用户填写的一些信息<br><img src="http://onxxjmg4z.bkt.clouddn.com/%E6%B3%A8%E5%86%8C%E6%88%90%E5%8A%9F2.png" alt=""></p>
<p>查看一下UserProfile用户信息表，发现了相应内容<br><img src="http://onxxjmg4z.bkt.clouddn.com/%E5%AF%86%E7%A0%81%E5%AF%86%E6%96%87.png" alt=""></p>
<h2 id="自定义登录"><a href="#自定义登录" class="headerlink" title="自定义登录"></a>自定义登录</h2><p>这里再提一下自定义登录，跟本文有一定的联系，因为使用了短信注册，那么后期登录肯定是要使用手机号进行登录，Django默认只能通过username，所以自定义一下登录规则，非常简单，将代码写到 users/views.py中</p>
<p>主要就是重写了authenticate，通过Q方法实现登录的并集逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">class CustomBackend(ModelBackend):</div><div class="line">    def authenticate(self, request, username=None, password=None, **kwargs):</div><div class="line">        try:</div><div class="line">            user = User.objects.get(Q(username=username)|Q(mobile=username))</div><div class="line">            if user.check_password(password):</div><div class="line">                return user</div><div class="line"></div><div class="line">        except Exception as e:</div><div class="line">            return None</div></pre></td></tr></table></figure>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>短信注册时很多web系统都有的部分，本文的代码写到不算精美，还有很多可以优化的地方，这就交个大家了</p>
<p>项目完整代码放到了Github上，各位点个Start<br><a href="https://github.com/ayuLiao/DjangoSMSReg" target="_blank" rel="external">Github Django实现用户短信注册 DjangoSMSReg</a></p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2017/11/18/PyCharm远程调试代码/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="ayuLiao's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        myemailliao@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="myemailliao@gmail.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">六月 2016<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">五月 2016<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags" title="标签">
                
                    <i class="material-icons sidebar-material-icons">label</i>
                
                标签
            </a>
        </li>
        
    
        <li>
            <a href="/timeline" title="时间轴">
                
                    <i class="material-icons sidebar-material-icons">timeline</i>
                
                时间轴
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://www.github.com/ayuliao" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2016&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>ayuLiao
            <div>
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <div>
        本站总访问量 <span id="busuanzi_value_site_pv"></span> &nbsp&nbsp&nbsp
        你是第<span id="busuanzi_value_site_uv"></span>个来到的小伙伴
        </div>
        </div>
        </div>

        <!-- Paradox Footer Right Section -->

        

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->


    <script>lsloader.load("js/lazyload.min.js","/js/lazyload.min.js?wgjW/HuQG9JDgvPDPoRAng==")</script>
    <script>lsloader.load("js/js.min.js","/js/js.min.js?oAl/+lvaqTFV31JXTmbrNA==")</script>



    <script>lsloader.load("js/nprogress.js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==")</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>



    
        <script>lsloader.load("js/smoothscroll.js","/js/smoothscroll.js?tNQK2Tw2SUL8a1Scn/Mgew==")</script>
    











<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Window Load-->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Bing Background -->


<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.4.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
