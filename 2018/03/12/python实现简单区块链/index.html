<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.4.0 -->
    <script>window.materialVersion = "1.4.0"</script>

    <!-- Title -->
    
    <title>
        
            python实现简单区块链 | 
        
        ayuLiao
    </title>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    
    
    
    
    
    
    
    
    

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="ayuLiao">
    <meta name="description" itemprop="description" content="">
    <meta name="keywords" content=",python">

    <!-- Site Verification -->
    
    

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="ayuLiao">

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://lmwen.top">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="python实现简单区块链 | ayuLiao">
    <meta property="og:image" content="/img/favicon.png" />
    <meta property="og:description" content="">
    <meta property="og:article:tag" content="python"> 

    
        <meta property="article:published_time" content="Mon Mar 12 2018 11:50:06 GMT+0800" />
        <meta property="article:modified_time" content="Sat Jul 07 2018 20:54:45 GMT+0800" />
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="python实现简单区块链 | ayuLiao">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="/img/favicon.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="http://lmwen.top" />

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://lmwen.top/2018/03/12/python实现简单区块链/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "ayuLiao",
        "logo": "/img/favicon.png"
    },
    "author": {
        "@type": "Person",
        "name": "ayuLiao",
        "image": {
            "@type": "ImageObject",
            "url": "/img/favicon.png"
        },
        "description": "过往不恋，未来不惧，当下不乱"
    },
    "headline": "python实现简单区块链",
    "url": "http://lmwen.top/2018/03/12/python实现简单区块链/index.html",
    "datePublished": "Mon Mar 12 2018 11:50:06 GMT+0800",
    "dateModified": "Sat Jul 07 2018 20:54:45 GMT+0800",
    "description": "",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://lmwen.top"
    }
}
</script>


    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+materialVersion+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(data&&data.indexOf(versionString)===-1){lsloader.removeLS(key)}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload){cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload);return}code=code.split(versionString)[1];if(/\.js?.+$/.test(versionNumber)){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload)}};lsloader.requestResource=function(name,path,cssonload){var that=this;if(/\.js?.+$/.test(path)){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else if(/\.css?.+$/.test(path)){this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import CSS & jQuery -->
    
        <style id="css/material.min.css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("css/material.min.css","/css/material.min.css?fJTiM/K1J3dWIruo3pxtAw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";})</script>
        <style id="css/style.min.css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("css/style.min.css","/css/style.min.css?oCSEO3ST+aEypEwttTDI9g==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";})</script>
        
        
            <style>
    
    
    
    .footer-sns-gplus {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNiA3OGMtMjIuNCA1LjItNTUuOCA0MC4yLTYwLjYgNjMuNC0xLjQgNi40LTIgMTI5LjgtMS42IDM2Ny42LjYgMjk4LjYgMSAzNTguOCAzLjQgMzYzIDExIDIwLjIgMjEuNiAzMi40IDM3LjIgNDMgMTUgMTAuMiAxNy40IDExLjIgMzMgMTMgMTEuMiAxLjQgMTM2IDIgMzY1IDEuNiAzMTQtLjYgMzQ4LjYtMSAzNTUtMy44IDE1LjgtNy4yIDMzLjgtMjIgNDMuMi0zNS40IDUuMi03LjQgMTAuOC0xNi42IDEyLjYtMjAuNCAyLjgtNi40IDMuMi00MC44IDMuOC0zNTQgLjQtMjIzLS4yLTM1My40LTEuNC0zNjUtMi0xNy0yLjYtMTguNi0xMy0zNC04LjYtMTIuNi0xNC4yLTE4LjQtMjUuMi0yNS44LTcuOC01LjQtMTcuNC0xMS0yMS42LTEyLjQtNi0yLjItNzIuOC0yLjYtMzY1LjQtMi42LTE5Ni44LjItMzYxIC44LTM2NC40IDEuOHpNNDMwIDI5NS40YzQwLjYgMTUuNCA1Ni42IDIzLjggNzIuNiAzOC40IDYuOCA2LjIgNy4yIDE1LjIgMSAyMy40LTYuMiA4LTMzLjYgMzMuOC0zOSAzNi42LTUuNiAyLjgtMTcuNiAyLjgtMjMuMi0uMi0yLjQtMS4yLTguMi01LjItMTMtOC44LTExLjItOC42LTI0LjYtMTEuMi01NS4yLTExLjItMjcuNCAwLTQwLjYgMi42LTUyLjIgMTAuNC00LjQgMi44LTEyLjIgNy42LTE3LjIgMTAuNi0yMyAxMy4yLTUxLjQgNTUtNTUuOCA4Mi40LTIuNiAxNS42LTIuNCAzNC44LjIgNTEgMi44IDE3LjQgMTkuOCA0OC44IDM1LjIgNjUuMiAxNiAxNi42IDQ1IDMzLjYgNjIuOCAzNi42IDI2LjggNC40IDY1LjggMS42IDc5LjQtNS44IDIwLjYtMTEuNCAzMS0xOSA0MS0zMC40IDE4LjgtMjEuNiAyMy40LTM0LjIgMTUuNi00My44LTMuOC00LjgtNC40LTQuOC01MS01LjgtNjAuOC0xLjItNTYuMiAyLjItNTYuMi00My4yIDAtMzIuNC4yLTMzLjIgNC44LTM3IDQuNC0zLjYgOS0zLjggOTItMy44IDc5IDAgODcuOC40IDk0LjIgMy42IDExLjIgNS42IDEzIDExLjQgMTIuOCA0My40IDAgMjUuNC0uOCAzMC44LTcuNiA1OC00IDE2LjYtOS44IDM0LTEyLjYgMzktMi44IDUtOC4yIDE0LjItMTEuNiAyMC42LTguNCAxNS40LTI3LjIgMzYuOC00MC44IDQ2LjYtNS44IDQuNC0xMy44IDEwLjItMTcuNiAxMy4yLTMuOCAzLTExIDctMTYuMiA4LjgtNS4yIDEuOC0xNi4yIDYuNC0yNC40IDEwLTIyLjQgOS42LTM0LjggMTEuNi03MyAxMS42LTM3LjYuMi00Ny0xLjQtNzEtMTItOC4yLTMuNi0xNy42LTcuMi0yMC44LTgtMTUuOC0zLjgtNjctNDUuMi03Ny44LTYyLjgtMi4yLTMuOC03LjYtMTEuNi0xMS44LTE3LjItNC4yLTUuNC05LTE0LTEwLjYtMTktMS44LTQuOC02LjItMTYtMTAtMjQuOC0zLjYtOC44LTcuOC0yMi4yLTkuMi0yOS42LTMuMi0xOC44LTEuNC03OS40IDIuOC05MS40IDEzLjgtNDAuNiAzNS42LTc4IDU4LjgtMTAwLjIgMTQtMTMuNiA0Ny4yLTM2LjQgNTgtMzkuOCA0LjItMS40IDEzLjQtNS4yIDIwLjYtOC40IDIyLTEwIDMyLjgtMTEuNiA3Ni0xMSAzMy44LjYgNDAuNCAxLjIgNTAgNC44em0zNDAuOCA4MC44YzggMy42IDkuNiAxMS4yIDkuMiAzOS4yLS42IDM0LjQtLjYgMzQgNSAzOS42IDQuOCA1IDUuNCA1IDM3LjYgNSA0My40IDAgNDQuNC44IDQzLjIgMzYuMi0uOCAxNy0xLjIgMTguNC02LjQgMjMtNS40IDQuNi02LjYgNC44LTM3LjYgNC44LTMxLjIgMC0zMiAuMi0zNi44IDUtNS42IDUuNC01LjYgNC40LTUgNDEuMi40IDI2LjQuMiAyNy40LTQuNiAzMy00LjggNS42LTYgNS44LTI0LjQgNi40LTIwLjguOC0yOS42LTEuNC0zMy40LTguNC0xLjQtMi42LTItMTUuNi0xLjgtMzUuNi40LTMxLjIuNC0zMS42LTQuNi0zNi42cy01LjYtNS0zNi01Yy0xOC44IDAtMzMtLjgtMzYtMi4yLTcuNi0zLjYtOS42LTExLjItOC44LTMzLjguOC0yOC4yLjQtMjggNDEtMjggNDUuNCAwIDQ1LjQgMCA0NC42LTQyLjYtLjYtMzMtLjYtMzMgNS0zOC40IDQuNC00LjYgNi4yLTUgMjQuOC01IDExIDAgMjIuMiAxIDI1IDIuMnoiLz48L3N2Zz4=);
    }
    
    
    
    
    
    .footer-sns-github {
        background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgY2xhc3M9Imljb24iIHZpZXdCb3g9IjAgMCAxMDI0IDEwMjQiPjxwYXRoIGQ9Ik0xMzguNCA3OGMtNi40IDEuNC0yNi40IDE0LjItMzYgMjIuOC04IDcuMi0yMiAyOS44LTI0LjQgMzkuMi0xLjYgNi40LTIgMTEzLjItMS42IDM2OCAuNiAyOTkuNCAxIDM1OS44IDMuNCAzNjQgMTEgMjAuMiAyMS42IDMyLjQgMzcuMiA0MyAxNS42IDEwLjYgMTcuMiAxMS4yIDM0LjIgMTMuMiAxMC42IDEuMiA2My40IDEuNiAxMjcuNiAxLjRsMTA5LjYtLjYgNi02LjggNi4yLTYuOC0xLjItMjUuMmMtLjgtMTUuOC0uMi0zMy40IDEuNC00Ny4yIDMtMjUuNCAxLjQtMzYuMi02LTQzLjItNS00LjYtNi4yLTQuOC0zMC42LTQuMi0yNy42LjgtMjQgMS42LTY4LjgtMTYtOC42LTMuNC0yMi42LTE4LTI4LjQtMjkuOC0xMS40LTIyLjgtMjctNDUtMzkuMi01NS42LTE0LTEyLjItMTkuOC0yMC44LTE5LjgtMjguNiAwLTExLjYgMTMuNi0xMi42IDMzLjItMi40IDE2LjYgOC44IDIwLjggMTIuNCA0MC44IDM2LjIgMjQuMiAyOC42IDMxIDMzLjYgNTQgMzkuNiAxNS4yIDQgNDIuMiAzIDUxLjQtMS44IDktNC42IDE4LTE1LjIgMjQuNC0yOS4yIDExLjQtMjQuMiA3LjQtMzEuMi0yMC42LTM2LjgtOS44LTItMjkuMi04LTQzLjQtMTMuNC00MC40LTE1LjgtNjQuNi0zNy40LTg1LjQtNzYuMi0xMS42LTIxLjgtMTUuNC0zMy0xOC4yLTUzLjYtNC4yLTMyLjItNC44LTYwLjItMS40LTg0IDMuNC0yMy44IDYuOC0zMi44IDIwLjItNTQgNC02IDguOC0xNS42IDExLTIxLjQgMy44LTEwIDMuOC0xMS42IDEtMzAtNS4yLTM0LjItMy4yLTUyLjQgNy42LTcwLjIgNy4yLTEyLjIgMTUtMTcuMiAyNC4yLTE1LjggMTIuOCAyLjIgNTIgMTcuNCA2Ni44IDI2LjIgMjYgMTUgMjkgMTUuNCA4Mi40IDcuMiAyNC42LTMuOCAzMy44LTQuMiA2MC0zLjIgMTcgLjYgNDEuNCAzIDU0IDUuMiAzOC40IDYuNiA0OS42IDUuMiA3My0xMCA2LjYtNC4yIDE3LjQtOS40IDI0LTExLjYgNi42LTIuMiAxNi01LjggMjEtOC4yIDEzLTYgMjgtNS42IDM1LjYuOCAxMi40IDEwLjQgMTguNiA0MS40IDE0LjQgNzEuNi00LjQgMzAuNi0zIDM5LjQgOC40IDUzLjggMy40IDQuNCAxMS4yIDE5LjIgMTcuNCAzMy4yTDc3NSA0NDN2NzhsLTEwIDI4Yy0xNS4yIDQzLjItMzYuOCA3My4yLTY2LjIgOTIuOC0xMy40IDguOC01NyAyNS40LTc2LjggMjktMjguMiA1LjItMzMuMiAxMi42LTIyIDMyLjIgMTEuMiAxOS40IDEyLjQgMzIuOCAxMS42IDEyOS42bC0uNiA4NS44IDUuNCA0LjZjMy42IDMgOS4yIDUuMiAxNiA2IDUuOC44IDYwLjIgMSAxMjAuNi42IDEwOC40LS42IDExMC4yLS42IDExOS01IDI0LTExLjYgNDAtMjcuNCA1MS42LTUwLjZsNS40LTExIC42LTM0N2MuNC0yMjMtLjItMzUzLjQtMS40LTM2NS0yLTE3LTIuNi0xOC42LTEzLTM0LTEwLjYtMTUuNC0yMi44LTI2LjItNDMuMi0zNy4yLTQuMi0yLjQtNjQuNi0yLjgtMzY2LTMuMi0xOTguNiAwLTM2NCAuNC0zNjcuNiAxLjR6Ii8+PC9zdmc+);
    }
    
    
    
    
    
</style>

        
        <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-color: #F5F5F5;
      }

      /* blog_info bottom background */
      #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
        background-color: #fff;
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"rel="stylesheet">


        <script>lsloader.load("js/jquery.min.js","/js/jquery.min.js?ezyEvm8ST5CGfpA+kFFi1g==")</script>
    
    
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Analytics -->
    

    <!-- Custom Head --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    
</head>


    
        <body id="scheme-Paradox" class="lazy">
            <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->

    <!-- Left aligned menu below button -->
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    
    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#简介"><span class="post-toc-number">1.</span> <span class="post-toc-text">简介</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#共识"><span class="post-toc-number">2.</span> <span class="post-toc-text">共识</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#创建区块链类"><span class="post-toc-number">3.</span> <span class="post-toc-text">创建区块链类</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#创建新区块"><span class="post-toc-number">4.</span> <span class="post-toc-text">创建新区块</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#创建新交易"><span class="post-toc-number">5.</span> <span class="post-toc-text">创建新交易</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#工作量证明-PoW-算法实现"><span class="post-toc-number">6.</span> <span class="post-toc-text">工作量证明(PoW)算法实现</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#验证区块链"><span class="post-toc-number">7.</span> <span class="post-toc-text">验证区块链</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#添加区块链网络节点"><span class="post-toc-number">8.</span> <span class="post-toc-text">添加区块链网络节点</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#共识算法"><span class="post-toc-number">9.</span> <span class="post-toc-text">共识算法</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#创建区块"><span class="post-toc-number">10.</span> <span class="post-toc-text">创建区块</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#创建新交易-1"><span class="post-toc-number">11.</span> <span class="post-toc-text">创建新交易</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#添加网络节点"><span class="post-toc-number">12.</span> <span class="post-toc-text">添加网络节点</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#区块链一致性"><span class="post-toc-number">13.</span> <span class="post-toc-text">区块链一致性</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#具体效果"><span class="post-toc-number">14.</span> <span class="post-toc-text">具体效果</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#结尾"><span class="post-toc-number">15.</span> <span class="post-toc-text">结尾</span></a></li></ol>
        <!--
        <li class="mdl-menu__item">
            Some Action
        </li>
        -->
    </ul>
    





<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        <!-- Custom Thumbnail -->
        <div class="post_thumbnail-custom mdl-card__media mdl-color-text--grey-50" style="background-image:url(http://obfs4iize.bkt.clouddn.com/python%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E5%8C%BA%E5%9D%97%E9%93%BE.jpg)">
    
            <p class="article-headline-p">
                python实现简单区块链
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>ayuLiao</strong>
        <span>3月 12, 2018</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/python/">python</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=python实现简单区块链&url=http://lmwen.top/2018/03/12/python实现简单区块链/index.html&pic=&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=python实现简单区块链&url=http://lmwen.top/2018/03/12/python实现简单区块链/index.html&via=ayuLiao" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://lmwen.top/2018/03/12/python实现简单区块链/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://lmwen.top/2018/03/12/python实现简单区块链/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    
        <a class="post_share-link" href="https://www.linkedin.com/shareArticle?mini=true&url=http://lmwen.top/2018/03/12/python实现简单区块链/index.html&title=python实现简单区块链" target="_blank">
            <li class="mdl-menu__item">
                分享到 LinkedIn
            </li>
        </a>
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>在逛github的时候看见这个项目<a href="https://github.com/dvf/blockchain" target="_blank" rel="external">blockchain</a>，该项目通过python实现了最简单的区块链，我将它复现了一下，并做了一些修改，比如创世区块需要挖矿才生成，而不直接生成，交易时会查看整条区块链确保账号金额足够，简化工作量证明算法等等，同时还加了详细的中文注释，项目地址如下，欢迎给星<a href="https://github.com/ayuLiao/myblockchain" target="_blank" rel="external">myblockchain</a></p>
<p>项目使用的环境：<br>mac pro，python3.6.3</p>
<p>第三方库：<br>flask,requests</p>
<p>如果觉得文章太臭太长可以拉到最后的结尾看我瞎扯一下</p>
<h2 id="共识"><a href="#共识" class="headerlink" title="共识"></a>共识</h2><p>再编写项目前，先有几个共识</p>
<ul>
<li>1.区块链是通过区块的hash链接起来的，具有不可修改的特性</li>
<li>2.要创建区块必须要进行PoW（工作量证明）</li>
<li>3.区块中存放交易记录、上个区块的hash和PoW</li>
<li>4.区块链网络是分布式、去中心化的，每个网络节点都存有一个区块链</li>
<li>5.每个节点的区块链都一样</li>
</ul>
<p>如果对上面的共识有疑惑或者不知道说什么，建议去看上一篇文章《比特币原理》，有了这些知识才能更好的理解区块链</p>
<h2 id="创建区块链类"><a href="#创建区块链类" class="headerlink" title="创建区块链类"></a>创建区块链类</h2><p>创建名为Blockchain类，该类用于存放区块链相关的所有内容，定义如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">class Blockchain:</div><div class="line">    def __init__(self):</div><div class="line">        # 交易列表</div><div class="line">        self.current_transactions = []</div><div class="line">        # 区块链</div><div class="line">        self.chain = []</div><div class="line">        # 网络节点</div><div class="line">        self.nodes = set()</div></pre></td></tr></table></figure>
<p>从<strong>init</strong>()方法中可以看到，我们使用current_transactions这个list来存放交易，chain来存放区块链，nodes来存放网络节点</p>
<p>解释一下，首先整个项目通过Flask运行到服务端，客户端通过访问服务器的某些接口进行挖矿、交易数字货币或者检查区块链合法新。这里通过nodes这个set类型变量来存放区块链网络中的节点，set类型确保了其中的数据不重复，我们需要知道区块链网络中的节点，才能进行共识算法的运算，使全网的区块链都一致，而区块链本身我们使用list简单存储一下，实际上区块链本身就是一个数据结构，这里为了简便，才直接使用list的</p>
<h2 id="创建新区块"><a href="#创建新区块" class="headerlink" title="创建新区块"></a>创建新区块</h2><p>Blockchain类（区块链类）创建好了，就往Blockchain类中加方法吧，首先要编写的new_block()方法，该方法用于创建一个新的区块，并将该区块添加到区块链中，具体定义如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">def new_block(self, proof, previous_hash):</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    创建一个新区块加入到区块链中</div><div class="line">    :param proof: 工作量证明</div><div class="line">    :param previous_hash: 上一个区块的hash</div><div class="line">    :return: 一个新区块</div><div class="line">    &apos;&apos;&apos;</div><div class="line"></div><div class="line">    # 区块</div><div class="line">    block = &#123;</div><div class="line">        # 索引</div><div class="line">        &apos;index&apos;:len(self.chain) + 1,</div><div class="line">        # 时间戳</div><div class="line">        &apos;timestamp&apos;: time(),</div><div class="line">        # 交易账本</div><div class="line">        &apos;transactions&apos;:self.current_transactions,</div><div class="line">        # 工作量证明</div><div class="line">        &apos;proof&apos;:proof,</div><div class="line">        # 上一块区块的hash</div><div class="line">        &apos;previous_hash&apos;:previous_hash or self.hash(self.chain[-1])</div><div class="line">    &#125;</div><div class="line">    # 从新置空</div><div class="line">    self.current_transactions = []</div><div class="line">    # 将区块添加到区块链中，此时交易账本是空，工作量证明是空</div><div class="line">    self.chain.append(block)</div><div class="line">    return block</div></pre></td></tr></table></figure>
<p>这个方法的代码很简单，首先创建了block这个dict类型的变量，它存储着一个完整区块所需的所有数据，其中有</p>
<ul>
<li>index:区块唯一索引，标明第几个区块</li>
<li>timestamp:创建区块时的时间戳</li>
<li>transactions:交易账本，其实记录着要存入这个区块的所有交易信息</li>
<li>proof:工作量证明，需要通过穷举法运算出来</li>
<li>previous_hash:上一个区块的hash</li>
</ul>
<p>其中transactions交易账本直接获取self.current_transactions中的值，previous_hash上个区块的hash要么使用参数，要么通过hash方法直接计算出上个区块的hash</p>
<p>这里顺带引出hash()方法的实现，在python是实现hash算法非常简单，导入hashlib这个库则可，hash()方法具体实现如下，该方法也在Blockchain类中，通过staticmethod定义成静态方法，不懂可以看这篇文章<a href="http://blog.csdn.net/handsomekang/article/details/9615239" target="_blank" rel="external">@staticmethod和@classmethod的作用与区别</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@staticmethod</div><div class="line">    def hash(block):</div><div class="line">        &apos;&apos;&apos;</div><div class="line">        使用SHA256哈希算法计算区块的哈希</div><div class="line">        :param block: 区块</div><div class="line">        :return: 区块hash</div><div class="line">        &apos;&apos;&apos;</div><div class="line">        block_string = json.dumps(block, sort_keys=True).encode()</div><div class="line">        return hashlib.sha256(block_string).hexdigest()</div></pre></td></tr></table></figure>
<p>其中使用json的dumps方法将区块这个dict序列化为json格式，注意要使用sort_keys=True，这样可以让json解析后获得的dict通过key排序，还有要使用encode()方法对json字符串进行utf-8编码，不然hashlib.sha256加密时会报编码类型错误</p>
<p>定义完block区块结构后，我们清空了交易list，避免已经加入区块的交易在下次创建新区块时又加入新的区块中。最后将定义好的区块加到chain区块链中</p>
<h2 id="创建新交易"><a href="#创建新交易" class="headerlink" title="创建新交易"></a>创建新交易</h2><p>在创建新区块时，我们将交易添加到了区块链中，但是到目前为止还没编写创建交易的方法，接着就来编写创建新交易的方法，具体代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">def new_transaction(self, sender, recipient, amount):</div><div class="line">&apos;&apos;&apos;</div><div class="line">创建一个新的交易，添加到我创建的下一个区块中</div><div class="line">:param sender: 发送者地址，发送数字币的地址</div><div class="line">:param recipient: 接受者地址，接受数字币的地址</div><div class="line">:param amount: 数字币数量</div><div class="line">:return: 记录本次交易的区块索引</div><div class="line">&apos;&apos;&apos;</div><div class="line">money = 0</div><div class="line">if sender != &apos;0&apos;:</div><div class="line">    for block in self.chain:</div><div class="line">        for transactions in block[&apos;transactions&apos;]:</div><div class="line">            if transactions[&apos;sender&apos;] == sender:</div><div class="line">                money -= transactions[&apos;amount&apos;]</div><div class="line">            if transactions[&apos;recipient&apos;] == sender:</div><div class="line">                money += transactions[&apos;amount&apos;]</div><div class="line"></div><div class="line">    if money &lt; amount:</div><div class="line">        return -1</div><div class="line"></div><div class="line"># 交易账本，可包含多个交易</div><div class="line">self.current_transactions.append(&#123;</div><div class="line">    &apos;sender&apos;:sender,</div><div class="line">    &apos;recipient&apos;:recipient,</div><div class="line">    &apos;amount&apos;:amount</div><div class="line">&#125;)</div><div class="line">if not self.chain:</div><div class="line">    return 0</div><div class="line"># 交易账本添加到最新的区块中</div><div class="line">return self.last_block[&apos;index&apos;] + 1</div></pre></td></tr></table></figure>
<p>创建交易的代码就也很简洁了，无非就是构建一个dict字典，将交易信息存到dict中构建出一个交易，然后将这个交易dict添加到self.current_transactions这个list中，并且返回这个交易将要被存放到的区块索引。</p>
<p>从代码中可以看出，构成一次交易的信息非常简单，就是发送者的地址、接受者的地址、交易时数字货币的数量，但是完成一次交易是有条件的，就是发送者拥有的数字货币数量大于要发送的数量，不然就无法完成交易，因为不够钱，判断也很简单，就是循环整个区块链，将与发送者有关的交易都统计一遍，获得当下发送者拥有的数字货币。如果发送者地址为0，说明是系统奖励给区块建立者的数字货币，就不必做这样的判断。</p>
<p>最后返回要存储这次交易记录的区块索引</p>
<h2 id="工作量证明-PoW-算法实现"><a href="#工作量证明-PoW-算法实现" class="headerlink" title="工作量证明(PoW)算法实现"></a>工作量证明(PoW)算法实现</h2><p>要创建一个合法的区块就需要进行PoW，PoW大致原理在《比特币原理》那篇文章中也提过，所以就直接来实现一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">    def proof_of_work(self, last_block):</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    简单的工作量证明算法</div><div class="line">    找到一个数，使得区块的hash前4位为0</div><div class="line">    :param last_proof 上一个区块的工作量证明</div><div class="line">    :return: 特殊的数</div><div class="line">    &apos;&apos;&apos;</div><div class="line"></div><div class="line">    # 工作量证明---&gt;穷举法计算出特殊的数</div><div class="line">    last_proof = last_block[&apos;proof&apos;]</div><div class="line">    last_hash = self.hash(last_block)</div><div class="line">    proof = 0</div><div class="line">    while self.valid_proof(proof,last_hash) is False:</div><div class="line">        proof += 1</div><div class="line"></div><div class="line">    return proof</div><div class="line"></div><div class="line">@staticmethod</div><div class="line">def valid_proof(proof, last_hash):</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    验证工作量证明，计算出的hash是否正确</div><div class="line">    对上一个区块的proof和hash与当期区块的proof最sha256运算</div><div class="line">    :param last_proof: 上一个区块的工作量</div><div class="line">    :param proof: 当前区块的工作量</div><div class="line">    :param last_hash: 上一个区块的hash</div><div class="line">    :return: True 工作量是正确的 False 错误</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    # f-string pyton3.6新的格式化字符串函数</div><div class="line">    guess = f&apos;&#123;proof&#125;&#123;last_hash&#125;&apos;.encode()</div><div class="line">    guess_hash = hashlib.sha256(guess).hexdigest()</div><div class="line">    return guess_hash[:4] == &quot;0000&quot;</div></pre></td></tr></table></figure>
<p>可以看到代码比较少，注释占多数:-D</p>
<p>工作量证明算法我们定义了两个方法，先看proof_of_work()方法，该方法简单讲就是通过穷举法计算出一个特殊的数，这个特殊的数就是本区块的工作量证明，其中通过valid_proof()方法来判断这个数是否特殊</p>
<p>再看到valid_proof()方法，首先用f函数格式化字符串，f函数是python3.6新添加的函数，它比我们常用的format()格式化函数快一倍，而且更加简单直观，大括号内括着的内容会被替换成相应变量的具体值，然后同样通过hashlib.sha256()来计算hash，然后判断该hash是否前4位为0，如果是，那么就找到了本区块的工作量证明了</p>
<p>在valid_proof()方法中计算工作量证明时只使用了上一个区块的hash，这其实就够了，需要注意的是，工作量证明虽然叫工作量证明，但它不单只是用于证明工作量，我们还需要用它来保护区块链，让区块链就有不可修改的特性，而计算时使用上一个区块的hash就能满足这两个要求，当区块中的数据改变时，该区块的hash也就变了，那么下一个区块就需要重新做工作量证明，这就需要花费大量的算了，因为我们这里只要求hash前4个为0，所以计算相对简单，但现实中没那么轻松，然计算在一个复杂度上才能避免他人算力的攻击。如果在计算区块的工作量证明时不使用上一个区块的hash，而是使用上一个区块中的其他数据，如上一个区块的PoW，虽然这样也能计算出本区块的PoW，但是就无法防御他人的算力攻击了，他人可以修改区块中的数据，但是不改这个区块的PoW，这样他就不用重新计算其他区块的PoW了，虽然区块的hash变了，但变了就变了，因为计算一个区块的hash很快就可以完成，又拥有了目前区块链中所有区块的PoW，完全可以造出一个一样长度的区块链，让网络中的节点难辨真假</p>
<h2 id="验证区块链"><a href="#验证区块链" class="headerlink" title="验证区块链"></a>验证区块链</h2><p>通过上面的努力，我们已经可以创建区块链了，接着就来编写验证区块链的逻辑，之所以要验证是因为在区块链是分布式去中心的，在区块链网络中会存在其他节点，此时我们无法确定我们手中的区块链就是最长的，需要获取网络中其他节点的区块链，为了避免其他节点发送非法的区块链给我们，就需要验证区块链，定义valid_chain()方法，用于验证区块链</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">def valid_chain(self, chain):</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    检验区块链是否是合法的</div><div class="line">    1.检查区块链是否连续</div><div class="line">    2.检查工作量证明是否正常</div><div class="line">    :param chain: 一份区块链</div><div class="line">    :return: True 区块链合法，False 区块链非法</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    last_block = chain[0] #创世区块</div><div class="line">    current_index = 1</div><div class="line"></div><div class="line">    # 循环检查每个区块</div><div class="line">    while current_index &lt; len(chain):</div><div class="line">        block = chain[current_index]</div><div class="line">        print(f&apos;&#123;last_block&#125;&apos;)</div><div class="line">        print(f&apos;&#123;block&#125;&apos;)</div><div class="line">        print(&apos;\n-----------\n&apos;)</div><div class="line">        # 本区块存储的hash是否等于上一个区块通过hash函数计算出的hash，判断区块链是否连续</div><div class="line">        if block[&apos;previous_hash&apos;] != self.hash(last_block):</div><div class="line">            return False</div><div class="line">        # 验证工作量证明是否计算正确</div><div class="line">        if not self.valid_proof(block[&apos;proof&apos;], block[&apos;previous_hash&apos;]):</div><div class="line">            return False</div><div class="line">        last_block = block</div><div class="line">        current_index += 1</div><div class="line">    return True</div></pre></td></tr></table></figure>
<p>验证区块链主要做两个动作</p>
<ul>
<li>1.检查区块链是否连续，其实就是判断每个区块中存的上一个区块的hash是否真的就是上一个区块的hash</li>
<li>2.检查区块中的PoW是否正确</li>
</ul>
<p>valid_chain()方法从创世区块开始判断，代码注释都很清楚，就不细讲了</p>
<h2 id="添加区块链网络节点"><a href="#添加区块链网络节点" class="headerlink" title="添加区块链网络节点"></a>添加区块链网络节点</h2><p>上面一直在说为了确认自身的区块链是否最长，需要向区块链网络中的其他节点请求他们的区块链，下面就来实现这部分逻辑</p>
<p>首先是添加节点，回忆一下，在一开始的<strong>init</strong>()方法中我们定义了set类型的nodes变量用于存放节点，定义register_node()方法，将其他节点的url地址添加进来则可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">def register_node(self, address):</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    添加新的节点进入区块链网络，分布式的目的是去中心化</div><div class="line">    :param address: 新节点网络地址，如：http://192.168.5.20:1314</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    # urlparse解析url &lt;scheme&gt;://&lt;netloc&gt;/&lt;path&gt;;&lt;params&gt;?&lt;query&gt;#&lt;fragment&gt;</div><div class="line">    parsed_url = urlparse(address)</div><div class="line">    # 将新节点的url地址添加到节点中</div><div class="line">    self.nodes.add(parsed_url.netloc)</div></pre></td></tr></table></figure>
<h2 id="共识算法"><a href="#共识算法" class="headerlink" title="共识算法"></a>共识算法</h2><p>共识算法用于回答：网络中有多个节点，如何区别节点间区块链一致性？这个问题，答案也很简单，网络中所有节点都使用最长的合法区块链则可，合法且最长表示该区块链消耗的运算资源最多</p>
<p>定义resolve_conflicts()方法实现共识算法，该方法做的事情也很简单，GET请求每个节点的接口，叫该节点将它的区块链发送给你，你判断一下发送过来的区块链是合法的，再判断一下发过来的区块链和你现在已有的区块链谁长，谁长用谁，具体代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">def resolve_conflicts(self):</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    共识算法，确保区块链网络中每个网络节点存储的区块链都是一致的，通过长区块链替换短区块链实现</div><div class="line">    :return: True 替换 False不替换</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    neighbours = self.nodes # 邻居节点</div><div class="line">    new_chain = None</div><div class="line">    # 我拥有区块链的长度</div><div class="line">    max_length = len(self.chain)</div><div class="line"></div><div class="line">    for node in neighbours:</div><div class="line">        # 访问节点的一个接口，拿到该接口的区块链长度和区块链本身</div><div class="line">        try:</div><div class="line">            response = requests.get(f&apos;http://&#123;node&#125;/chain&apos;)</div><div class="line">            if response.status_code == 200:</div><div class="line">                length = response.json()[&apos;length&apos;]</div><div class="line">                chain = response.json()[&apos;chain&apos;]</div><div class="line"></div><div class="line">                # 判断邻居节点发送过来的区块链长度是否最长且是否合法</div><div class="line">                if length &gt; max_length and self.valid_chain(chain):</div><div class="line">                    # 使用邻居节点的区块链</div><div class="line">                    max_length = length</div><div class="line">                    new_chain = chain</div><div class="line">        except:</div><div class="line">            # 节点没开机</div><div class="line">            pass</div><div class="line">    if new_chain:</div><div class="line">        self.chain = new_chain</div><div class="line">        return True</div><div class="line">    return False</div></pre></td></tr></table></figure>
<p>看到网络请求，可能你也就知道Flask的用途了，响应这些请求，必须节点都是在网络上，那么必须有处理请求的功能，使用一个现成的web框架是最简单的做法</p>
<p>到这里Blockchain类就编写完了，还差一个简单的方法，用于获取区块链中最后一个区块，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@property</div><div class="line">    def last_block(self):</div><div class="line">        &apos;&apos;&apos;</div><div class="line">        :return: 区块链中最后一个区块</div><div class="line">        &apos;&apos;&apos;</div><div class="line">        return self.chain[-1]</div></pre></td></tr></table></figure>
<h2 id="创建区块"><a href="#创建区块" class="headerlink" title="创建区块"></a>创建区块</h2><p>前面讲了这么久，其实就是定义一个Blockchain类，它提供了很多核心方法，但我们似乎还是没办法创建区块，因为没有些调用new_block()方法的逻辑啊，现在就来写写。</p>
<p>因为整个项目是搭建在Flask上，所以我们定义一个接口专门用于生成新的区块，也就是俗称的挖矿，接口名为mine，具体代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">@app.route(&apos;/mine&apos;, methods=[&apos;GET&apos;])</div><div class="line">def mine():</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    建立新区块</div><div class="line">    :return:</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    if not blockchain.chain:</div><div class="line">        blockchain.new_transaction(sender=&apos;0&apos;, recipient=node_identifier, amount=50)</div><div class="line">        block = blockchain.new_block(previous_hash=&apos;1&apos;, proof=100)</div><div class="line">        response = &#123;</div><div class="line">            &apos;message&apos;: &apos;创世区块建立&apos;,</div><div class="line">            &apos;index&apos;: block[&apos;index&apos;],</div><div class="line">            &apos;transactions&apos;: block[&apos;transactions&apos;],</div><div class="line">            &apos;proof&apos;: block[&apos;proof&apos;],</div><div class="line">            &apos;previous_hash&apos;: block[&apos;previous_hash&apos;],</div><div class="line">        &#125;</div><div class="line">        return jsonify(response), 200</div><div class="line"></div><div class="line">    last_block = blockchain.last_block</div><div class="line">    proof = blockchain.proof_of_work(last_block)</div><div class="line">    # 挖矿获得一个数字货币奖励，将奖励的交易记录添加到账本中，其他的交易记录通过new_transaction接口添加</div><div class="line">    blockchain.new_transaction(sender=&apos;0&apos;, recipient=node_identifier, amount=6)</div><div class="line"></div><div class="line">    previous_hash = blockchain.hash(last_block)</div><div class="line">    block = blockchain.new_block(proof, previous_hash)</div><div class="line"></div><div class="line">    response = &#123;</div><div class="line">        &apos;message&apos;:&apos;新区块建立&apos;,</div><div class="line">        &apos;index&apos;:block[&apos;index&apos;],</div><div class="line">        &apos;transactions&apos;:block[&apos;transactions&apos;],</div><div class="line">        &apos;proof&apos;:block[&apos;proof&apos;],</div><div class="line">        &apos;previous_hash&apos;:block[&apos;previous_hash&apos;],</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return jsonify(response),200</div></pre></td></tr></table></figure>
<p>当有人通过GET方法来访问mine接口时，就会调用mine()方法，mine()方法中的逻辑很简单，首先判断区块链是否存在，不存在，说明要创建创世区块，创建区块时系统会奖励给区块创建者数字货币，代码实现就是通过new_transaction()方法添加一个新的交易，发送者的地址为0，表示系统，接受者通过uuid4()方法生成一个ID，这个ID就唯一表示这个接受者，可以理解成他的钱包地址，uuid4()基于伪随机数来生成一串数字，因为是基于伪随机数，所以生成的这串数字可能会重复的。</p>
<p>交易添加好，就调用new_bloc()方法创建创世区块就好了</p>
<p>如果区块链本来就存在了，说明区块链中已经有区块了，那么就通过区块链中最后一个区块的hash来计算本区块的工作量证明(使用proof_of_work()方法)，然后给在新区块中添加系统奖励的交易记录,最后调用new_block()方法创建出区块</p>
<h2 id="创建新交易-1"><a href="#创建新交易-1" class="headerlink" title="创建新交易"></a>创建新交易</h2><p>现在区块时可以创建了，但是区块上记录的交易只有系统奖励，太单调了，所以接着来编写创建新交易的方法，同样定义一个接口，客户端将交易信息发送到这个接口就可以创建出新的交易，具体代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@app.route(&apos;/transactions/new&apos;, methods=[&apos;POST&apos;])</div><div class="line">def new_transaction():</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    将新的交易添加到最新的区块中</div><div class="line">    :return:</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    values = request.get_json()</div><div class="line"></div><div class="line">    required = [&apos;sender&apos;, &apos;recipient&apos;, &apos;amount&apos;]</div><div class="line">    if not all(k in values for k in required):</div><div class="line">        return &apos;缺失必要字段&apos;,400</div><div class="line"></div><div class="line">    index = blockchain.new_transaction(values[&apos;sender&apos;], values[&apos;recipient&apos;],values[&apos;amount&apos;])</div><div class="line">    if index == -1:</div><div class="line">        return &apos;余额不足&apos;,400</div><div class="line">    response = &#123;&apos;message&apos;:f&apos;交易账本被添加到新的区块中&#123;index&#125;&apos;&#125;</div><div class="line">    return jsonify(response),201</div></pre></td></tr></table></figure>
<p>首先受到客户端的交易请求信息，判断其中是否具有发起者地址sender、接受者地址recipient、交易数字货币量amount，有才是个合法的请求，然后调用new_transaction()方法创建交易就好了</p>
<p>可能有人会迷惑，创建交易似乎和创建区块分离开了？其实没有，当我们调用new_transaction()方法创建交易时，其实就是往self.current_transactions这个list中添加信息，而调用new_block()方法创建新区块时，会将self.current_transactions存到区块中，完成区块和交易的绑定</p>
<h2 id="添加网络节点"><a href="#添加网络节点" class="headerlink" title="添加网络节点"></a>添加网络节点</h2><p>不用多说了，区块链要去中心就需要多个节点，当区块链网络上有其他节点时，可以将它注册到进该节点，只有注册了，本节点才能感知到其他节点，同样定义一个接口来注册节点，代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">@app.route(&apos;/nodes/register&apos;, methods=[&apos;POST&apos;])</div><div class="line">def register_nodes():</div><div class="line">    values = request.get_json()</div><div class="line">    nodes = values.get(&apos;nodes&apos;)</div><div class="line">    if nodes is None:</div><div class="line">        return &apos;Error:提供有效节点列表&apos;,400</div><div class="line"></div><div class="line">    for node in nodes:</div><div class="line">        blockchain.register_node(node)</div><div class="line"></div><div class="line">    response = &#123;</div><div class="line">        &apos;message&apos;: &apos;新节点加入区块链网络&apos;,</div><div class="line">        &apos;total_nodes&apos;:list(blockchain.nodes),</div><div class="line">    &#125;</div><div class="line">    return jsonify(response),201</div></pre></td></tr></table></figure>
<p>没啥难度，就是解析一下客户端发来的注册节点请求，然后调用register_node()方法注册一下就好了</p>
<h2 id="区块链一致性"><a href="#区块链一致性" class="headerlink" title="区块链一致性"></a>区块链一致性</h2><p>节点注册好后，就需要确保这些节点中区块链是一致的了，同样定义一个接口来做这个事情，其实就是调用resolve_conflicts()方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">@app.route(&apos;/node/resolve&apos;, methods=[&apos;GET&apos;])</div><div class="line">def consensus():</div><div class="line">    replaced = blockchain.resolve_conflicts()</div><div class="line">    if replaced:</div><div class="line">        response = &#123;</div><div class="line">            &apos;message&apos;:&apos;本节点区块链被替换&apos;,</div><div class="line">            &apos;new_chain&apos;:blockchain.chain</div><div class="line">        &#125;</div><div class="line">    else:</div><div class="line">        response=&#123;</div><div class="line">            &apos;message&apos;:&apos;本节点区块链是权威的(区块链网络中最长的)&apos;,</div><div class="line">            &apos;chain&apos;:blockchain.chain</div><div class="line">        &#125;</div><div class="line">    return  jsonify(response),200</div></pre></td></tr></table></figure>
<p>最后为了方便，我们定义出一个接口用于展示整个区块链</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@app.route(&apos;/chain&apos;, methods=[&apos;GET&apos;])</div><div class="line">def full_chain():</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    获得完整的区块链</div><div class="line">    :return: 整份区块链</div><div class="line">    &apos;&apos;&apos;</div><div class="line">    response = &#123;</div><div class="line">        &apos;chain&apos;:blockchain.chain,</div><div class="line">        &apos;length&apos;:len(blockchain.chain),</div><div class="line">    &#125;</div><div class="line">    return jsonify(response),200</div></pre></td></tr></table></figure>
<p>最后写一段简单的开启服务器的代码就好了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">if __name__ == &apos;__main__&apos;:</div><div class="line">    from argparse import ArgumentParser</div><div class="line"></div><div class="line">    parser = ArgumentParser()</div><div class="line">    parser.add_argument(&apos;-p&apos;,&apos;--port&apos;, default=5000, type=int, help=&apos;服务启动时对应的端口&apos;)</div><div class="line">    args = parser.parse_args()</div><div class="line">    port = args.port</div><div class="line">    app.run(host=&apos;0.0.0.0&apos;, port=port)</div></pre></td></tr></table></figure>
<h2 id="具体效果"><a href="#具体效果" class="headerlink" title="具体效果"></a>具体效果</h2><p>到这里，代码就全部编写完成了，可以跑一波看看是否符合预期了，因为项目运行到Flask中，所以要弄个客户端来请求上面定义好的接口，直接使用postman来发送请求就好了</p>
<p>通过下面命令将区块链服务开启，并绑定到5000端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python myblockchain.py -p 5000</div></pre></td></tr></table></figure>
<p><img src="http://obfs4iize.bkt.clouddn.com/%E5%90%AF%E5%8A%A8myblockchain.png" alt=""></p>
<p>先使用postman请求chain接口，看看此时节点上有无区块链，发现是空的，因为还没有开始创建区块</p>
<p><img src="http://obfs4iize.bkt.clouddn.com/emtpyblock.png" alt=""></p>
<p>那么就请求mine接口来创建区块吧，第一次请求mine接口，创建出了创世区块，创世区块中记录了唯一一个交易就是系统奖励，奖励了50个数字货币给创世区块的创造者，比特币的创世区块也是奖励50个币，这里向本聪哥致敬</p>
<p><img src="http://obfs4iize.bkt.clouddn.com/1block.png" alt=""></p>
<p>继续请求mine接口，创造第二个区块</p>
<p><img src="http://obfs4iize.bkt.clouddn.com/2block.png" alt=""></p>
<p>第二个区块依旧没有交易，只有系统奖励，6个数字货币</p>
<p>其实这里已经有一个节点地址了，就是f675e46d829a44fc85783a87f1b52284，它创建了2个区块，已经有了56个数字货币，那我让他发5个数字货币给ayuliao，接济一下我这个穷人</p>
<p><img src="http://obfs4iize.bkt.clouddn.com/1transactions.png" alt=""></p>
<p>这个交易是要写入第三个区块中的，但是此时第三个区块还没被创建出来，那么在第三个区块创建出来前，这些交易都会写到这个区块中，比如我再让他发50个币给我</p>
<p><img src="http://obfs4iize.bkt.clouddn.com/2transactions.png" alt=""></p>
<p>交易完后，调用mine接口，创建第三块区块，它就包含了刚刚的两个交易记录和系统对区块建立者的奖励</p>
<p><img src="http://obfs4iize.bkt.clouddn.com/3block.png" alt=""></p>
<p>此时调用chain接口，就可以发现该节点已经有3个区块了</p>
<p><img src="http://obfs4iize.bkt.clouddn.com/4block.png" alt=""></p>
<p>此时你已经转了55个币给我了，你就剩下一个数字货币了，此时你又想转10币给我是会失败的</p>
<p><img src="http://obfs4iize.bkt.clouddn.com/nomoneyblock.png" alt=""></p>
<p>为了验证前面编写的共识算法，也就是多节点区块链的一致性，这里再开启一个服务，你可以开在其他电脑，或者同一台电脑的不同端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python myblockchain.py -p 5001</div></pre></td></tr></table></figure>
<p>开始了5001后，请求5001的mine接口，让5001创建区块，让他创建2个区块，也就是请求两次mine接口，此时5001的区块链长为2，而且跟5000节点的完全不同</p>
<p><img src="http://obfs4iize.bkt.clouddn.com/5001block1.png" alt=""></p>
<p>此时将5000节点注册到5001节点中，调用5001的/nodes/register接口(你可以通过注册多个节点)</p>
<p><img src="http://obfs4iize.bkt.clouddn.com/add_nodes.png" alt=""></p>
<p>然后我们来访问5001的node/resolve接口，使用其共识算法，让5001这个节点的区块链与区块链网络上的一直，其实就是判断5001自己手上的区块链跟网络上其他节点的区块链相比是不是最长的，其实我们知道目前为止应该是5000节点拥有的区块链最长，所以5001节点上的区块链会被替换成5000节点上的区块链，以求网络上所有节点的区块链保持一致</p>
<p><img src="http://obfs4iize.bkt.clouddn.com/replaceblockchain.png" alt=""></p>
<p>到这里这个项目也就表演完了</p>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>这个项目虽然简单，但是区块链核心的东西都体现出来了，可以说麻雀虽小，五脏俱全，当前这个项目还是有些失真的，现实中的区块链项目会比这个复杂很多，也正是因为从头开发一个区块链项目是很复杂，才会出现Ethereum(以太坊)这样的平台型区块链项目，它已经将区块链的底层都帮我们实现好了，你可以直接将你的代码通过智能合约的形式写到Ethereum中，这样你的项目凭借Ethereum平台就自动拥有了区块链的所有特性，在Ethereum中虽然智能合约、智能合约的叫，但当你接触后，你就会发现，智能合约并不智能。</p>
<p>还有一点需要提一下，在这个项目中，建立创世区块时，建立者获得了系统50个数字货币的奖励，这50个是可以花费的，但是在现实的比特币中，创世区块奖励的比特币是不能使用的，原因如下</p>
<blockquote>
<p>创世块的收益花不掉，原因如下：比特币客户端把区块和交易分开存贮在两个数据库中，当客户端发现区块数据库为空时，用代码直接生成一个创世块，但是没有生成这个交易，所以客户端中的交易数据库中是没有发送到上述地址这个交易的，因而一旦收到要花掉该收益的交易时，都会拒绝，所以无法得到任何确认，就花不掉这50个币。出现这种情况很可能是中本聪故意的</p>
</blockquote>
<p>在创建创世区块时，系统将50个币发送到了这个地址1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa，据说是中本聪本人，虽然这个地址上的比特币不能使用，但是还有有人将比特币源源不断的转到这个账号，事实上，这个创世区块里的地址目前有66.76869249个比特币，是通过1174笔交易发送的，他们将一笔笔钱发送到这个不可交易的账号上可能有点荒谬，但这其实人们（对中本聪）表达感谢的方式</p>
<p><img src="http://obfs4iize.bkt.clouddn.com/%E5%88%9B%E4%B8%96block.png" alt=""></p>
<p>最后还有点很有意思</p>
<blockquote>
<p>中本聪挖出创世区块花了六天的时间。在早期的比特币论坛上有人猜测，这可能中本聪故意而为之，模仿圣经中关于创世的描述。《创世纪》第2章第2节上记载：“到第七日，上帝结束了他的工作，便休息了。”</p>
</blockquote>
<p>这操作，太骚了，我们这等凡人与聪哥差距太大:-D</p>

    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2018/03/17/python爆破加密的zip/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2018/02/15/浅谈用户分享逻辑实现/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="ayuLiao's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        myemailliao@gmail.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="myemailliao@gmail.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2018/07/">七月 2018<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/06/">六月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/05/">五月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/04/">四月 2018<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/02/">二月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/01/">一月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/08/">八月 2016<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/06/">六月 2016<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/05/">五月 2016<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags" title="标签">
                
                    <i class="material-icons sidebar-material-icons">label</i>
                
                标签
            </a>
        </li>
        
    
        <li>
            <a href="/timeline" title="时间轴">
                
                    <i class="material-icons sidebar-material-icons">timeline</i>
                
                时间轴
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://www.github.com/ayuliao" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2016&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>ayuLiao
            <div>
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <div>
        本站总访问量 <span id="busuanzi_value_site_pv"></span> &nbsp&nbsp&nbsp
        你是第<span id="busuanzi_value_site_uv"></span>个来到的小伙伴
        </div>
        </div>
        </div>

        <!-- Paradox Footer Right Section -->

        

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import File -->


    <script>lsloader.load("js/lazyload.min.js","/js/lazyload.min.js?wgjW/HuQG9JDgvPDPoRAng==")</script>
    <script>lsloader.load("js/js.min.js","/js/js.min.js?oAl/+lvaqTFV31JXTmbrNA==")</script>



    <script>lsloader.load("js/nprogress.js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==")</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>



    
        <script>lsloader.load("js/smoothscroll.js","/js/smoothscroll.js?tNQK2Tw2SUL8a1Scn/Mgew==")</script>
    











<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Window Load-->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });
</script>

<!-- MathJax Load-->

<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Bing Background -->


<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.4.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
        </body>
    
</html>
